"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[426],{8426:(S,d,u)=>{u.r(d),u.d(d,{ContFacturaModulo:()=>v});var m=u(177),g=u(8871),i=u(9417),h=u(1626),t=u(8699),b=u(8527),F=u(3149);function f(r,l){if(1&r&&(t.j41(0,"option",10),t.EFF(1),t.k0s()),2&r){const a=l.$implicit;t.Y8G("ngValue",a.cod_sucursal),t.R7$(1),t.JRh(a.nom_sucursal)}}function p(r,l){if(1&r){const a=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td")(10,"button",39),t.bIt("click",function(){const e=t.eBV(a),s=e.$implicit,o=e.index,c=t.XpG();return t.Njj(c.abrirEditar(s,o))}),t.EFF(11,"Editar"),t.k0s(),t.j41(12,"button",40),t.bIt("click",function(){const s=t.eBV(a).$implicit,o=t.XpG();return t.Njj(o.eliminar(s))}),t.EFF(13,"Eliminar"),t.k0s()()()}if(2&r){const a=l.$implicit,n=t.XpG();t.R7$(2),t.JRh(a.id||a.cod),t.R7$(2),t.JRh(n.descSucursal(a)),t.R7$(2),t.JRh(a.ano),t.R7$(2),t.JRh(a.contador)}}function C(r,l){if(1&r&&(t.j41(0,"option",10),t.EFF(1),t.k0s()),2&r){const a=l.$implicit;t.Y8G("ngValue",a.cod_sucursal),t.R7$(1),t.JRh(a.nom_sucursal)}}const _=[{path:"",component:(()=>{class r{constructor(a,n){this.contSrv=a,this.sucSrv=n,this.items=[],this.sucursales=[],this.editIndex=-1,this.actual={idsucursal:void 0,ano:(new Date).getFullYear(),contador:0},this.detalleSeleccionado=null,this.pageSize=10,this.currentPage=1}ngOnInit(){this.cargarSucursales(),this.cargarItems()}unwrapList(a){return a?Array.isArray(a)?a:Array.isArray(a?.data)?a.data:Array.isArray(a?.items)?a.items:Array.isArray(a?.data?.items)?a.data.items:[]:[]}cargarSucursales(){this.sucSrv.buscarTodasSucursal().subscribe({next:a=>{this.sucursales=this.unwrapList(a)},error:()=>{this.sucursales=[]}})}cargarItems(a=this.currentPage){this.currentPage=a,this.contSrv.buscarTodos(this.currentPage,this.pageSize,this.filtroSucursal).subscribe({next:n=>{this.items=this.unwrapList(n)},error:()=>{this.items=[]}})}nombreSucursal(a){const n=Number(a);return this.sucursales.find(s=>Number(s?.cod_sucursal)===n)?.nom_sucursal||"-"}descSucursal(a){return a?.sucursal?.nom_sucursal||this.nombreSucursal(a?.idsucursal??a?.cod_sucursal??a?.sucursal)}abrirNuevo(){this.editIndex=-1,this.actual={idsucursal:void 0,ano:(new Date).getFullYear(),contador:0},this.detalleSeleccionado=null}abrirEditar(a,n){this.editIndex=n;const e=Number(a?.id||a?.cod||0);e?this.contSrv.buscarPorId(e).subscribe({next:s=>{const o=Array.isArray(s?.data)?s.data[0]:s?.data||s;this.detalleSeleccionado=o||a,this.actual={idsucursal:o?.idsucursal??o?.sucursal?.cod_sucursal??a?.idsucursal??a?.cod_sucursal??void 0,ano:o?.ano??a?.ano??(new Date).getFullYear(),contador:o?.contador??a?.contador??0}},error:()=>{this.detalleSeleccionado=a,this.actual={idsucursal:a?.idsucursal??a?.cod_sucursal??void 0,ano:a?.ano??(new Date).getFullYear(),contador:a?.contador??0}}}):(this.detalleSeleccionado=a,this.actual={idsucursal:a?.idsucursal??a?.cod_sucursal??void 0,ano:a?.ano??(new Date).getFullYear(),contador:a?.contador??0})}guardar(a){if(!a.valid)return;const n={idsucursal:Number(this.actual.idsucursal),ano:Number(this.actual.ano),contador:Number(this.actual.contador)};if(this.editIndex>=0){const e=this.items[this.editIndex],s=Number(e?.id||e?.cod||0);if(!s)return;this.contSrv.editarContFactura(s,n).subscribe({next:()=>{this.cargarItems()},error:()=>{}})}else this.contSrv.guardarContFactura(n).subscribe({next:()=>{this.cargarItems()},error:()=>{}});this.editIndex=-1,this.actual={idsucursal:void 0,ano:(new Date).getFullYear(),contador:0},a.resetForm({idsucursal:void 0,ano:(new Date).getFullYear(),contador:0})}eliminar(a){const n=Number(a?.id||a?.cod||0);n&&this.contSrv.eliminarContFactura(n).subscribe({next:()=>{this.cargarItems()},error:()=>{}})}static{this.\u0275fac=function(n){return new(n||r)(t.rXU(b.Z),t.rXU(F.F))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-config-contfactura"]],decls:64,vars:12,consts:[[1,"container-fluid"],[1,"row","g-3"],[1,"col-12"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center"],[1,"bi","bi-receipt","me-2"],[1,"mb-0"],[1,"d-flex","align-items-center","gap-2"],[1,"form-select","form-select-sm","w-auto",3,"ngModel","ngModelChange","change"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["data-bs-toggle","modal","data-bs-target","#contFacModal",1,"btn","btn-light","btn-sm",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[2,"width","10%"],[2,"width","30%"],[2,"width","15%"],[2,"width","20%"],[4,"ngFor","ngForOf"],["id","contFacModal","tabindex","-1","aria-labelledby","contFacModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","contFacModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[3,"ngSubmit"],["contForm","ngForm"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],["name","idsucursal","required","",1,"form-select",3,"ngModel","ngModelChange"],["type","number","name","ano","required","",1,"form-control",3,"ngModel","ngModelChange"],["type","number","name","contador","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-primary",3,"disabled"],["data-bs-toggle","modal","data-bs-target","#contFacModal",1,"btn","btn-primary","btn-sm","me-2",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(n,e){if(1&n){const s=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6),t.j41(7,"h5",7),t.EFF(8,"Control Factura"),t.k0s()(),t.j41(9,"div",8)(10,"select",9),t.bIt("ngModelChange",function(c){return e.filtroSucursal=c})("change",function(){return e.cargarItems(1)}),t.j41(11,"option",10),t.EFF(12,"Filtrar por sucursal"),t.k0s(),t.DNE(13,f,2,2,"option",11),t.k0s(),t.j41(14,"button",12),t.bIt("click",function(){return e.abrirNuevo()}),t.nrm(15,"i",13),t.EFF(16," Nuevo "),t.k0s()()(),t.j41(17,"div",14)(18,"div",15)(19,"table",16)(20,"thead")(21,"tr")(22,"th",17),t.EFF(23,"#"),t.k0s(),t.j41(24,"th",18),t.EFF(25,"Sucursal"),t.k0s(),t.j41(26,"th",19),t.EFF(27,"A\xf1o"),t.k0s(),t.j41(28,"th",19),t.EFF(29,"Contador"),t.k0s(),t.j41(30,"th",20),t.EFF(31,"Acciones"),t.k0s()()(),t.j41(32,"tbody"),t.DNE(33,p,14,4,"tr",21),t.k0s()()()()()()(),t.j41(34,"div",22)(35,"div",23)(36,"div",24)(37,"div",25)(38,"h5",26),t.EFF(39),t.k0s(),t.nrm(40,"button",27),t.k0s(),t.j41(41,"form",28,29),t.bIt("ngSubmit",function(){t.eBV(s);const c=t.sdS(42);return t.Njj(e.guardar(c))}),t.j41(43,"div",30)(44,"div",31)(45,"label",32),t.EFF(46,"Sucursal"),t.k0s(),t.j41(47,"select",33),t.bIt("ngModelChange",function(c){return e.actual.idsucursal=c}),t.j41(48,"option",10),t.EFF(49,"Seleccione una sucursal"),t.k0s(),t.DNE(50,C,2,2,"option",11),t.k0s()(),t.j41(51,"div",31)(52,"label",32),t.EFF(53,"A\xf1o"),t.k0s(),t.j41(54,"input",34),t.bIt("ngModelChange",function(c){return e.actual.ano=c}),t.k0s()(),t.j41(55,"div",31)(56,"label",32),t.EFF(57,"Contador"),t.k0s(),t.j41(58,"input",35),t.bIt("ngModelChange",function(c){return e.actual.contador=c}),t.k0s()()(),t.j41(59,"div",36)(60,"button",37),t.EFF(61,"Cancelar"),t.k0s(),t.j41(62,"button",38),t.EFF(63),t.k0s()()()()()()()}if(2&n){const s=t.sdS(42);t.R7$(10),t.Y8G("ngModel",e.filtroSucursal),t.R7$(1),t.Y8G("ngValue",void 0),t.R7$(2),t.Y8G("ngForOf",e.sucursales),t.R7$(20),t.Y8G("ngForOf",e.items),t.R7$(6),t.JRh(e.editIndex>=0?"Editar Control Factura":"Nuevo Control Factura"),t.R7$(8),t.Y8G("ngModel",e.actual.idsucursal),t.R7$(1),t.Y8G("ngValue",void 0),t.R7$(2),t.Y8G("ngForOf",e.sucursales),t.R7$(4),t.Y8G("ngModel",e.actual.ano),t.R7$(4),t.Y8G("ngModel",e.actual.contador),t.R7$(4),t.Y8G("disabled",!s.valid),t.R7$(1),t.JRh(e.editIndex>=0?"Guardar cambios":"Agregar")}},dependencies:[m.Sq,i.qT,i.xH,i.y7,i.me,i.Q0,i.wz,i.BC,i.cb,i.YS,i.vS,i.cV],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.uppercase-input[_ngcontent-%COMP%]{text-transform:uppercase}"]})}}return r})()}];let v=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=t.$C({type:r})}static{this.\u0275inj=t.G2t({imports:[m.MD,i.YN,h.q1,g.iI.forChild(_)]})}}return r})()}}]);