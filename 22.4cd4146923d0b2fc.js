"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[22],{7022:(E,m,l)=>{l.r(m),l.d(m,{PermisoModulo:()=>k});var g=l(177),b=l(8871),d=l(9417),h=l(1626),e=l(8699),p=l(9191),F=l(5961),f=l(6687);function P(r,u){if(1&r){const i=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.j41(5,"small",43),e.EFF(6),e.k0s()(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td")(14,"button",44),e.bIt("click",function(){const t=e.eBV(i),a=t.$implicit,n=t.index,s=e.XpG();return e.Njj(s.abrirModalEditar(a,n))}),e.nrm(15,"i",45),e.k0s(),e.j41(16,"button",46),e.bIt("click",function(){const a=e.eBV(i).$implicit,n=e.XpG();return e.Njj(n.eliminarPermiso(a))}),e.nrm(17,"i",47),e.k0s()()()}if(2&r){const i=u.$implicit,o=e.XpG();e.R7$(2),e.JRh(i.idpermiso),e.R7$(2),e.SpI(" ",o.nombreUsuario(i.idusuario)," "),e.R7$(2),e.SpI("(",i.idusuario,")"),e.R7$(2),e.JRh(o.descModulo(i.idmodulo)),e.R7$(2),e.JRh(i.acceso),e.R7$(2),e.JRh(i.lectura)}}function v(r,u){if(1&r&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&r){const i=u.$implicit;e.Y8G("ngValue",i.codUsuario),e.R7$(1),e.Lme("",i.nombreUsuario," (",i.idUsuario,")")}}function M(r,u){if(1&r&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&r){const i=u.$implicit;e.Y8G("ngValue",i.idmodulo),e.R7$(1),e.JRh(i.descmodulo)}}const j=[{path:"",component:(()=>{class r{constructor(i,o,t){this.permisoSrv=i,this.moduloSrv=o,this.usuarioSrv=t,this.permisos=[],this.modulos=[],this.usuarios=[],this.filtro="",this.actual={idusuario:"",idmodulo:void 0,acceso:"N",lectura:"N"},this.editIndex=-1}ngOnInit(){this.cargarDatosIniciales()}unwrapList(i){return i?Array.isArray(i)?i:Array.isArray(i?.data)?i.data:Array.isArray(i?.items)?i.items:Array.isArray(i?.data?.items)?i.data.items:[]:[]}cargarDatosIniciales(){this.cargarPermisos(),this.cargarModulos(),this.cargarUsuarios()}cargarPermisos(){this.permisoSrv.obtenerTodosPermiso().subscribe({next:i=>{this.permisos=this.unwrapList(i)},error:()=>{this.permisos=[]}})}cargarModulos(){this.moduloSrv.obtenerTodosModulo().subscribe({next:i=>{this.modulos=this.unwrapList(i)},error:()=>{this.modulos=[]}})}cargarUsuarios(){this.usuarioSrv.buscarTodosUsuario(1,200).subscribe({next:i=>{this.usuarios=this.unwrapList(i)},error:()=>{this.usuarios=[]}})}descModulo(i){return i&&this.modulos.find(t=>t?.idmodulo===i)?.descmodulo||"-"}nombreUsuario(i){if(null==i||""===i)return"-";const o=Number(i);return this.usuarios.find(a=>Number(a?.codUsuario)===o)?.nombreUsuario||"-"}get listaFiltrada(){const i=this.filtro.trim().toLowerCase();return i?this.permisos.filter(o=>{const t=this.descModulo(o?.idmodulo).toLowerCase(),a=this.nombreUsuario(o?.idusuario).toLowerCase();return String(o?.idpermiso||"").includes(i)||String(o?.idusuario||"").toLowerCase().includes(i)||a.includes(i)||String(o?.acceso||"").toLowerCase().includes(i)||String(o?.lectura||"").toLowerCase().includes(i)||t.includes(i)}):this.permisos}abrirModalNuevo(){this.editIndex=-1,this.actual={idusuario:"",idmodulo:void 0,acceso:"N",lectura:"N"}}abrirModalEditar(i,o){this.editIndex=o,this.actual={idusuario:i?.idusuario,idmodulo:i?.idmodulo,acceso:i?.acceso,lectura:i?.lectura}}guardarPermiso(i){if(!i.valid)return;const o=Number(this.actual.idusuario),t=Number(this.actual.idmodulo),a=(this.actual.acceso||"N").toUpperCase(),n=(this.actual.lectura||"N").toUpperCase();if(!o||isNaN(o)||!t||isNaN(t)||!["S","N"].includes(a)||!["S","N"].includes(n))return;const s={idusuario:o,idmodulo:t,acceso:a,lectura:n};if(this.editIndex>=0){const c=this.permisos[this.editIndex];this.permisoSrv.editarPermiso(c.idpermiso,s).subscribe({next:()=>{c.idusuario=o,c.idmodulo=t,c.acceso=a,c.lectura=n,this.cargarPermisos()},error:()=>{}})}else this.permisoSrv.guardarPermiso(s).subscribe({next:()=>{this.cargarPermisos()},error:()=>{}});this.editIndex=-1,this.actual={idusuario:"",idmodulo:void 0,acceso:"N",lectura:"N"},i.resetForm({idusuario:"",idmodulo:void 0,acceso:"N",lectura:"N"})}eliminarPermiso(i){!i||!i.idpermiso||this.permisoSrv.eliminarPermiso(i.idpermiso).subscribe({next:()=>{this.cargarPermisos()},error:()=>{}})}static{this.\u0275fac=function(o){return new(o||r)(e.rXU(p.m),e.rXU(F.V),e.rXU(f.f))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-config-permiso"]],decls:82,vars:13,consts:[[1,"container-fluid"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center"],[1,"bi","bi-shield-lock","me-2"],[1,"mb-0"],[1,"card-body"],[1,"row","g-3","mb-3"],[1,"col-12","col-md-6"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Buscar permiso...",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-12","col-md-6","text-md-end"],["data-bs-toggle","modal","data-bs-target","#permisoModal",1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[4,"ngFor","ngForOf"],["id","permisoModal","tabindex","-1","aria-labelledby","permisoModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","permisoModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[3,"ngSubmit"],["permisoForm","ngForm"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],["name","idusuario","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["name","idmodulo","required","",1,"form-select",3,"ngModel","ngModelChange"],[1,"row","g-3"],[1,"col-6"],["name","acceso","required","",1,"form-select",3,"ngModel","ngModelChange"],["value","S"],["value","N"],["name","lectura","required","",1,"form-select",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-primary",3,"disabled"],[1,"bi","bi-save","me-1"],[1,"text-muted"],["data-bs-toggle","modal","data-bs-target","#permisoModal","title","Editar permiso","aria-label","Editar permiso",1,"btn","btn-primary","btn-sm","me-2",3,"click"],[1,"bi","bi-pencil"],["title","Eliminar permiso","aria-label","Eliminar permiso",1,"btn","btn-danger","btn-sm",3,"click"],[1,"bi","bi-trash"]],template:function(o,t){if(1&o){const a=e.RV6();e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"i",3),e.j41(4,"h5",4),e.EFF(5,"Configuraci\xf3n - Permisos"),e.k0s()(),e.j41(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"span",9),e.nrm(11,"i",10),e.k0s(),e.j41(12,"input",11),e.bIt("ngModelChange",function(s){return t.filtro=s}),e.k0s()()(),e.j41(13,"div",12)(14,"button",13),e.bIt("click",function(){return t.abrirModalNuevo()}),e.nrm(15,"i",14),e.EFF(16," Nuevo Permiso "),e.k0s()()(),e.j41(17,"div",15)(18,"table",16)(19,"thead")(20,"tr")(21,"th"),e.EFF(22,"#"),e.k0s(),e.j41(23,"th"),e.EFF(24,"Usuario"),e.k0s(),e.j41(25,"th"),e.EFF(26,"M\xf3dulo"),e.k0s(),e.j41(27,"th"),e.EFF(28,"Acceso"),e.k0s(),e.j41(29,"th"),e.EFF(30,"Lectura"),e.k0s(),e.j41(31,"th"),e.EFF(32,"Acciones"),e.k0s()()(),e.j41(33,"tbody"),e.DNE(34,P,18,6,"tr",17),e.k0s()()()()()(),e.j41(35,"div",18)(36,"div",19)(37,"div",20)(38,"div",21)(39,"h5",22),e.EFF(40),e.k0s(),e.nrm(41,"button",23),e.k0s(),e.j41(42,"form",24,25),e.bIt("ngSubmit",function(){e.eBV(a);const s=e.sdS(43);return e.Njj(t.guardarPermiso(s))}),e.j41(44,"div",26)(45,"div",27)(46,"label",28),e.EFF(47,"Usuario"),e.k0s(),e.j41(48,"select",29),e.bIt("ngModelChange",function(s){return t.actual.idusuario=s}),e.j41(49,"option",30),e.EFF(50,"Seleccione un usuario"),e.k0s(),e.DNE(51,v,2,3,"option",31),e.k0s()(),e.j41(52,"div",27)(53,"label",28),e.EFF(54,"M\xf3dulo"),e.k0s(),e.j41(55,"select",32),e.bIt("ngModelChange",function(s){return t.actual.idmodulo=s}),e.j41(56,"option",30),e.EFF(57,"Seleccione un m\xf3dulo"),e.k0s(),e.DNE(58,M,2,2,"option",31),e.k0s()(),e.j41(59,"div",33)(60,"div",34)(61,"label",28),e.EFF(62,"Acceso"),e.k0s(),e.j41(63,"select",35),e.bIt("ngModelChange",function(s){return t.actual.acceso=s}),e.j41(64,"option",36),e.EFF(65,"S\xed"),e.k0s(),e.j41(66,"option",37),e.EFF(67,"No"),e.k0s()()(),e.j41(68,"div",34)(69,"label",28),e.EFF(70,"Lectura"),e.k0s(),e.j41(71,"select",38),e.bIt("ngModelChange",function(s){return t.actual.lectura=s}),e.j41(72,"option",36),e.EFF(73,"S\xed"),e.k0s(),e.j41(74,"option",37),e.EFF(75,"No"),e.k0s()()()()(),e.j41(76,"div",39)(77,"button",40),e.EFF(78,"Cancelar"),e.k0s(),e.j41(79,"button",41),e.nrm(80,"i",42),e.EFF(81),e.k0s()()()()()()}if(2&o){const a=e.sdS(43);e.R7$(12),e.Y8G("ngModel",t.filtro),e.R7$(22),e.Y8G("ngForOf",t.listaFiltrada),e.R7$(6),e.JRh(t.editIndex>=0?"Editar permiso":"Nuevo permiso"),e.R7$(8),e.Y8G("ngModel",t.actual.idusuario),e.R7$(1),e.Y8G("ngValue",""),e.R7$(2),e.Y8G("ngForOf",t.usuarios),e.R7$(4),e.Y8G("ngModel",t.actual.idmodulo),e.R7$(1),e.Y8G("ngValue",void 0),e.R7$(2),e.Y8G("ngForOf",t.modulos),e.R7$(5),e.Y8G("ngModel",t.actual.acceso),e.R7$(8),e.Y8G("ngModel",t.actual.lectura),e.R7$(8),e.Y8G("disabled",!a.valid),e.R7$(2),e.SpI(" ",t.editIndex>=0?"Guardar cambios":"Agregar"," ")}},dependencies:[g.Sq,d.qT,d.xH,d.y7,d.me,d.wz,d.BC,d.cb,d.YS,d.vS,d.cV],styles:[".card[_ngcontent-%COMP%]{border-radius:.5rem}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.85rem}@media (max-width: 576px){.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1rem}}"]})}}return r})()}];let k=(()=>{class r{static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[g.MD,d.YN,h.q1,b.iI.forChild(j)]})}}return r})()}}]);