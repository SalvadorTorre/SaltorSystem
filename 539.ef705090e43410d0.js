"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[539],{1539:(S,p,s)=>{s.r(p),s.d(p,{ModuloDespacho:()=>M});var d=s(9417),f=s(177),m=s(8871),b=s(5378),g=s(4941),F=s.n(g),t=s(8699),v=s(9287);let D=(()=>{class n{constructor(e){this.http=e}buscarPorCedula(e){return this.http.GetRequest(`/despachadores/cedula/${e}`)}static{this.\u0275fac=function(a){return new(a||n)(t.KVO(v.a))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var _=s(1757);const j=["cedulaInput"],C=["facturaInput"];function k(n,h){if(1&n){const e=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.generarPDF())}),t.nrm(1,"i",30),t.EFF(2," Exportar a PDF"),t.k0s()}}function y(n,h){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(1),t.JRh(e.mensaje)}}function R(n,h){if(1&n&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s()()),2&n){const e=h.$implicit;t.R7$(2),t.JRh(e.df_codMerc),t.R7$(2),t.JRh(e.df_desMerc),t.R7$(2),t.JRh(e.df_canMerc),t.R7$(2),t.JRh(e.df_preMerc),t.R7$(2),t.JRh(e.df_valMerc)}}function E(n,h){if(1&n&&(t.j41(0,"div",32)(1,"table",33)(2,"thead",34)(3,"tr")(4,"th"),t.EFF(5,"C\xf3digo"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Descripci\xf3n"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Cantidad"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Precio"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Total"),t.k0s()()(),t.j41(14,"tbody"),t.DNE(15,R,11,5,"tr",35),t.k0s()()()),2&n){const e=t.XpG();t.R7$(15),t.Y8G("ngForOf",e.facturaData.detalles)}}function N(n,h){if(1&n&&(t.j41(0,"div",9)(1,"div",36)(2,"label",37),t.EFF(3,"C\xf3digo"),t.k0s(),t.nrm(4,"input",20),t.k0s(),t.j41(5,"div",36)(6,"label",37),t.EFF(7,"Nombre"),t.k0s(),t.nrm(8,"input",20),t.k0s(),t.j41(9,"div",36)(10,"label",37),t.EFF(11,"Tipo"),t.k0s(),t.nrm(12,"input",20),t.k0s(),t.j41(13,"div",36)(14,"label",37),t.EFF(15,"Status"),t.k0s(),t.nrm(16,"input",20),t.k0s()()),2&n){const e=t.XpG();t.R7$(4),t.Y8G("value",(null==e.despacho?null:e.despacho.codDesp)||""),t.R7$(4),t.Y8G("value",(null==e.despacho?null:e.despacho.nomDesp)||""),t.R7$(4),t.Y8G("value",(null==e.despacho?null:e.despacho.tipoDesp)||""),t.R7$(4),t.Y8G("value",(null==e.despacho?null:e.despacho.status)||"")}}const $=[{path:"",component:(()=>{class n{constructor(e,a){this.despachoService=e,this.serviciofacturacion=a,this.cedula="",this.despacho={},this.mensaje="",this.factura="",this.facturaNumero="",this.clienteNombre="",this.facturaData=null}buscarDespachador(e){""!==this.cedula.trim()?(this.despachoService.buscarPorCedula(this.cedula).subscribe(a=>{if(console.log(a),!a)return this.despacho=null,this.mensaje="No se encontr\xf3 un despachador con esa c\xe9dula",void console.log("Buscando:",this.cedula);console.log("Buscando despachador con c\xe9dula:",this.cedula),this.despacho=a.data[0],this.mensaje=""}),e.focus()):this.mensaje="Debe ingresar una c\xe9dula"}buscarFactura(){console.log("N\xfamero ingresado:",this.facturaNumero),this.facturaNumero&&""!==this.facturaNumero.trim()?(console.log("Buscando factura con n\xfamero:",this.facturaNumero),this.serviciofacturacion.getByNumero(this.facturaNumero).subscribe(e=>{e?(this.facturaData=e,console.log("facturaData",this.facturaData),this.mensaje="",this.generarPDF()):(this.facturaData=null,this.mensaje="No se encontr\xf3 una factura con ese n\xfamero")})):this.mensaje="Debe ingresar un n\xfamero de factura"}limpiarCampos(){this.cedula="",this.despacho=null,this.facturaNumero="",this.facturaData=null,this.mensaje="Campos reiniciados",this.clienteNombre="",setTimeout(()=>{this.cedulaInput?.nativeElement&&this.cedulaInput.nativeElement.focus()},0)}generarPDF(){if(!this.facturaData)return void alert("Debe buscar una factura primero");const e=this.facturaData,a=new b.default({orientation:"p",unit:"mm",format:[72,297]}),o=new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP",minimumFractionDigits:2}),c=a.internal.pageSize.getWidth();a.setFontSize(12),a.setTextColor(0,0,0),a.text("FACTURA",c/2,10,{align:"center"}),a.setFontSize(8),a.setTextColor(0,0,0),a.text(`Factura No: ${e.fa_codFact}`,2,20),a.text(`Fecha: ${e.fa_fecFact}`,2,25),a.text(`Cliente: ${e.fa_nomClie}`,2,30),a.text(`RNC: ${e.fa_rncFact||"N/A"}`,2,35),a.text(`Direcci\xf3n: ${e.fa_dirClie}`,2,40),a.text(`Tel\xe9fono: ${e.fa_telClie}`,2,45),a.text(`Vendedor: ${e.fa_nomVend}`,2,50);const l=[];e.detalles.forEach(u=>{l.push([{content:u.df_canMerc,styles:{halign:"right"}},{content:u.df_preMerc,styles:{halign:"right"}},{content:u.df_itbiMerc||"0.00",styles:{halign:"right"}},{content:u.df_valMerc,styles:{halign:"right"}},""]),l.push([{content:`${u.df_desMerc} (${u.df_codMerc})`,colSpan:5,styles:{halign:"left",fontStyle:"italic"}}])}),F()(a,{startY:52,head:[["Cant.","Precio","Itbis","Total",""]],body:l,theme:"plain",headStyles:{fontSize:7,textColor:0,fontStyle:"bold",fillColor:!1,lineColor:[0,0,0],lineWidth:{top:.3,right:0,bottom:.3,left:0}},bodyStyles:{fontSize:7,lineWidth:0,cellPadding:{top:.5,bottom:.5}},margin:{left:2},columnStyles:{0:{cellWidth:12,halign:"left"},1:{cellWidth:12,halign:"right"},2:{cellWidth:15,halign:"right"},3:{cellWidth:15,halign:"right"},4:{cellWidth:10,halign:"right"}}});const r=a.lastAutoTable.finalY||70;a.setFontSize(7),a.text("Subtotal:",5,r+7),a.text(o.format(Number(e.fa_subFact)),17,r+7),a.text("ITBIS:",5,r+10),a.text(o.format(Number(e.fa_itbiFact)),17,r+10),a.setFontSize(8),a.setFont("helvetica","bold"),a.text("Total:",5,r+13),a.text(o.format(Number(e.fa_valFact)),17,r+13),a.setFont("helvetica","normal"),a.text("Recibido Conforme",c/2,290,{align:"center"}),a.save(`Factura_${e.fa_codFact}.pdf`)}static{this.\u0275fac=function(a){return new(a||n)(t.rXU(D),t.rXU(_._))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["despacho"]],viewQuery:function(a,o){if(1&a&&(t.GBs(j,5),t.GBs(C,5)),2&a){let c;t.mGM(c=t.lsd())&&(o.cedulaInput=c.first),t.mGM(c=t.lsd())&&(o.facturaInputRef=c.first)}},decls:45,vars:8,consts:[[1,"container-fluid","mt-4"],[1,"card","shadow-sm","p-4"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-3"],[1,"m-0"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-eraser"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","alert alert-info mb-3","role","alert",4,"ngIf"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"row","g-2","align-items-end"],[1,"col-12","col-sm-4"],["for","cedula",1,"form-label"],[1,"col-12","col-sm-5"],["type","text","id","cedula","placeholder","Ingrese la c\xe9dula",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],["cedulaInput",""],[1,"col-12","col-sm-3","d-grid"],[1,"btn","btn-primary",3,"click"],[1,"col-12"],["readonly","",1,"form-control",3,"value"],["for","factura",1,"form-label"],["type","text","id","factura","name","facturaNumero","placeholder","Ingrese la Factura",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],["facturaInput",""],[1,"btn","btn-secondary",3,"click"],[1,"row","g-3","mt-3"],["class","table-responsive",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"col-12","col-md-6","d-flex","align-items-start","justify-content-md-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-filetype-pdf"],["role","alert",1,"alert","alert-info","mb-3"],[1,"table-responsive"],[1,"table","table-bordered","table-striped","table-sm"],[1,"table-dark"],[4,"ngFor","ngForOf"],[1,"col-12","col-sm-6"],[1,"form-label"]],template:function(a,o){if(1&a){const c=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),t.EFF(4,"Despacho"),t.k0s(),t.j41(5,"div",4)(6,"button",5),t.bIt("click",function(){return o.limpiarCampos()}),t.nrm(7,"i",6),t.EFF(8," Limpiar"),t.k0s(),t.DNE(9,k,3,0,"button",7),t.k0s()(),t.DNE(10,y,2,1,"div",8),t.j41(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"label",13),t.EFF(16,"C\xe9dula"),t.k0s()(),t.j41(17,"div",14)(18,"input",15,16),t.bIt("ngModelChange",function(l){return o.cedula=l})("keyup.enter",function(){t.eBV(c);const l=t.sdS(32);return t.Njj(o.buscarDespachador(l))}),t.k0s()(),t.j41(20,"div",17)(21,"button",18),t.bIt("click",function(){t.eBV(c);const l=t.sdS(32);return t.Njj(o.buscarDespachador(l))}),t.EFF(22,"Buscar"),t.k0s()(),t.j41(23,"div",19),t.nrm(24,"input",20),t.k0s()()(),t.j41(25,"div",10)(26,"div",11)(27,"div",12)(28,"label",21),t.EFF(29,"Factura"),t.k0s()(),t.j41(30,"div",14)(31,"input",22,23),t.bIt("ngModelChange",function(l){return o.facturaNumero=l})("keyup.enter",function(){return o.buscarFactura()}),t.k0s()(),t.j41(33,"div",17)(34,"button",24),t.bIt("click",function(){return o.buscarFactura()}),t.EFF(35,"Buscar Factura"),t.k0s()(),t.j41(36,"div",19),t.nrm(37,"input",20),t.k0s()()()(),t.j41(38,"div",25)(39,"div",19),t.DNE(40,E,16,1,"div",26),t.k0s()(),t.j41(41,"div",25)(42,"div",10),t.DNE(43,N,17,4,"div",27),t.k0s(),t.nrm(44,"div",28),t.k0s()()()}2&a&&(t.R7$(9),t.Y8G("ngIf",o.facturaData),t.R7$(1),t.Y8G("ngIf",o.mensaje),t.R7$(8),t.Y8G("ngModel",o.cedula),t.R7$(6),t.Y8G("value",(null==o.despacho?null:o.despacho.nomDesp)||""),t.R7$(7),t.Y8G("ngModel",o.facturaNumero),t.R7$(6),t.Y8G("value",(null==o.facturaData?null:o.facturaData.fa_nomClie)||""),t.R7$(3),t.Y8G("ngIf",null==o.facturaData||null==o.facturaData.detalles?null:o.facturaData.detalles.length),t.R7$(3),t.Y8G("ngIf",o.despacho))},dependencies:[f.Sq,f.bT,d.me,d.BC,d.vS]})}}return n})()}];let I=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[m.iI.forChild($),m.iI]})}}return n})(),M=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[f.MD,I,d.X1,d.YN]})}}return n})()}}]);