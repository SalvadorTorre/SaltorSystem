"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[442],{4442:(S,m,c)=>{c.r(m),c.d(m,{ModuloEncf:()=>Y});var f=c(177),l=c(9417),g=c(8871),u=c(983),b=c(6354),E=c(5558),F=c(980),C=c(8032),d=c.n(C);class h{constructor(a){this.id=a?.id??0,this.cantencf=a?.cantencf??0,this.countencf=a?.countencf??0,this.alertaencf=a?.alertaencf??0,this.codempr=a?.codempr??"",this.desdeencf=a?.desdeencf??0,this.fechaencf=a?.fechaencf??"",this.hastaencf=a?.hastaencf??0,this.tipoencf=a?.tipoencf??"",this.empresacodempr=a?.empresacodempr??void 0}}var e=c(8699),v=c(5353),j=c(9287);let k=(()=>{class i{constructor(t){this.http=t}obtenerTodos(){return this.http.GetRequest("/tiposncf")}obtenerPorTipo(t){return this.http.GetRequest(`/tiposncf/${t}`)}static{this.\u0275fac=function(r){return new(r||i)(e.KVO(j.a))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var y=c(2265);function M(i,a){if(1&i&&(e.j41(0,"option",64),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.cod_empre),e.R7$(1),e.Lme("",t.nom_empre," (",t.cod_empre,")")}}function _(i,a){if(1&i&&(e.j41(0,"option",64),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.codigo),e.R7$(1),e.Lme("",t.tipo," - ",t.desNcf,"")}}function x(i,a){1&i&&e.nrm(0,"span",65)}function R(i,a){1&i&&e.nrm(0,"i",66)}function T(i,a){if(1&i&&(e.j41(0,"span",85),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(1),e.SpI("",t.alertaencf,"%")}}function I(i,a){1&i&&(e.j41(0,"span",86),e.EFF(1,"-"),e.k0s())}function $(i,a){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td",67)(2,"div",59),e.EFF(3),e.k0s(),e.j41(4,"div",68),e.EFF(5),e.k0s()(),e.j41(6,"td")(7,"span",69),e.EFF(8),e.k0s()(),e.j41(9,"td",70),e.EFF(10),e.nrm(11,"i",71),e.EFF(12),e.k0s(),e.j41(13,"td",72),e.EFF(14),e.nI1(15,"number"),e.k0s(),e.j41(16,"td",73)(17,"span",74),e.EFF(18),e.nI1(19,"number"),e.k0s()(),e.j41(20,"td",75),e.nrm(21,"i",76),e.EFF(22),e.nI1(23,"date"),e.k0s(),e.j41(24,"td",73),e.DNE(25,T,2,1,"span",77),e.DNE(26,I,2,0,"span",78),e.k0s(),e.j41(27,"td",79)(28,"div",80)(29,"button",81),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.editar(o))}),e.nrm(30,"i",82),e.k0s(),e.j41(31,"button",83),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.eliminar(o))}),e.nrm(32,"i",84),e.k0s()()()()}if(2&i){const t=a.$implicit,r=e.XpG();e.R7$(3),e.JRh((null==t.empresacodempr?null:t.empresacodempr.nom_empre)||t.codempr),e.R7$(2),e.JRh(t.codempr),e.R7$(3),e.JRh(r.tipoDescripcion(t.tipoencf)),e.R7$(2),e.SpI(" ",t.desdeencf," "),e.R7$(2),e.SpI(" ",t.hastaencf," "),e.R7$(2),e.JRh(e.bMT(15,10,t.cantencf)),e.R7$(4),e.JRh(e.bMT(19,12,t.countencf)),e.R7$(4),e.SpI(" ",e.i5U(23,14,t.fechaencf,"dd/MM/yyyy")," "),e.R7$(3),e.Y8G("ngIf",t.alertaencf),e.R7$(1),e.Y8G("ngIf",!t.alertaencf)}}function w(i,a){1&i&&(e.j41(0,"tr")(1,"td",87)(2,"div",88)(3,"div",89),e.nrm(4,"i",90),e.k0s(),e.j41(5,"span",91),e.EFF(6,"No hay comprobantes registrados"),e.k0s(),e.j41(7,"small",58),e.EFF(8,"Utiliza el formulario superior para agregar uno nuevo."),e.k0s()()()())}const N=[{path:"",component:(()=>{class i{constructor(t,r,n){this.servicioEncf=t,this.servicioTiponcf=r,this.servicioEmpresa=n,this.encf=new h,this.listaEncf=[],this.editIndex=-1,this.page=1,this.limit=10,this.tiposNcf=[],this.empresas=[],this.guardando=!1,this.filtroCodempr="",this.filtroTipo="",this.filtroDescripcion="",this.paginacion={total:0,page:1,limit:this.limit,totalPages:1}}ngOnInit(){this.cargarEncf(),this.cargarTiposNcf(),this.cargarEmpresas()}cargarEncf(){this.servicioEncf.listarEncf(this.page,this.limit,this.filtroCodempr||void 0,this.filtroDescripcion||void 0,this.filtroTipo||void 0).subscribe({next:t=>{const r=Array.isArray(t)?t:t?.data;this.listaEncf=r??[];const n=Array.isArray(t)?null:t?.pagination;n?this.paginacion={total:Number(n?.total||0),page:Number(n?.page||this.page),limit:Number(n?.limit||this.limit),totalPages:Number(n?.totalPages||1)}:(this.paginacion.page=this.page,this.paginacion.limit=this.limit,this.paginacion.total=this.listaEncf.length,this.paginacion.totalPages=Math.max(1,Math.ceil(this.paginacion.total/this.limit)))},error:t=>{console.error("Error cargando ENCF",t)}})}cargarTiposNcf(){this.servicioTiponcf.obtenerTodos().subscribe({next:t=>{const r=Array.isArray(t)?t:t?.data;this.tiposNcf=r??[]},error:t=>{console.error("Error cargando tipos NCF",t)}})}cargarEmpresas(){this.servicioEmpresa.buscarTodasEmpresa(1,100).subscribe({next:t=>{this.empresas=t?.data??[]},error:t=>{console.error("Error cargando empresas",t)}})}tipoDescripcion(t){return t?this.tiposNcf.find(n=>n.tipo===t)?.desNcf??t:""}existeDuplicado(t,r,n){return this.servicioEncf.listarEncf(1,5,t,void 0,r).pipe((0,b.T)(o=>((Array.isArray(o)?o:o?.data)??[]).some(p=>p.codempr===t&&p.tipoencf===r&&(!n||p.id!==n))))}aplicarFiltros(){this.page=1,this.cargarEncf()}limpiarFiltros(){this.filtroCodempr="",this.filtroTipo="",this.filtroDescripcion="",this.page=1,this.cargarEncf()}cambiarPagina(t){t<1||t>(this.paginacion.totalPages||1)||(this.page=t,this.cargarEncf())}guardarEncf(){if(!this.encf.codempr||!this.encf.tipoencf||!this.encf.fechaencf)return void d().fire({title:"Formulario incompleto",text:"Debe completar: Empresa, Tipo y Fecha.",icon:"warning"});const t={codempr:this.encf.codempr,cantencf:this.encf.cantencf,countencf:this.encf.countencf,alertaencf:this.encf.alertaencf,fechaencf:this.encf.fechaencf,hastaencf:this.encf.hastaencf,tipoencf:this.encf.tipoencf,desdeencf:this.encf.desdeencf};this.guardando=!0,this.existeDuplicado(this.encf.codempr,this.encf.tipoencf,this.encf.id).pipe((0,E.n)(r=>r?(d().fire({title:"Duplicado",text:"Esta empresa ya tiene un ENCF con ese tipo.",icon:"warning"}),u.w):(this.editIndex>=0||this.encf.id)&&this.encf.id?this.servicioEncf.editarEncf(this.encf.id,t):this.servicioEncf.crearEncf(t)),(0,F.j)(()=>{this.guardando=!1})).subscribe({next:()=>{this.limpiarFormulario(),this.cargarEncf();const r=!(this.editIndex<0);d().fire({title:"Excelente!",text:r?"ENCF actualizado correctamente.":"ENCF guardado correctamente.",icon:"success",timer:2e3,showConfirmButton:!1})},error:r=>{if(409===r?.status)d().fire({title:"Duplicado",text:"La empresa ya posee este tipo ENCF.",icon:"warning"});else{console.error("Error al guardar ENCF",r);const n=r?.error?.message||r?.message||"Ocurri\xf3 un error al guardar el ENCF.";d().fire({title:"Error",text:n,icon:"error"})}}})}limpiarFormulario(){this.encf=new h,this.editIndex=-1}editar(t){const r=this.listaEncf.findIndex(n=>n===t);this.editIndex=r,this.encf={...t}}eliminar(t){t?.id&&d().fire({title:"\xbfEst\xe1 seguro de eliminar este ENCF?",text:"\xa1No podr\xe1 revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&this.servicioEncf.eliminarEncf(t.id).subscribe({next:()=>{d().fire({title:"Excelente!",text:"ENCF eliminado correctamente.",icon:"success",timer:2e3,showConfirmButton:!1}),this.limpiarFormulario(),this.cargarEncf()},error:n=>{const o=n?.error?.message||n?.message||"Error al eliminar el ENCF.";d().fire({title:"Error",text:o,icon:"error"})}})})}static{this.\u0275fac=function(r){return new(r||i)(e.rXU(v.t),e.rXU(k),e.rXU(y.g))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-encf"]],decls:130,vars:20,consts:[[1,"container-fluid","py-4","bg-light","min-vh-100"],[1,"row","g-4","justify-content-center"],[1,"col-lg-12"],[1,"card","shadow-sm","border-0","rounded-4","overflow-hidden"],[1,"card-header","bg-white","border-bottom","py-3","px-4"],[1,"d-flex","align-items-center"],[1,"bg-primary","bg-opacity-10","p-2","rounded-circle","me-3","text-primary"],[1,"bi","bi-receipt-cutoff","fs-5"],[1,"mb-0","fw-bold","text-dark"],[1,"card-body","p-4"],[3,"ngSubmit"],["encfForm","ngForm"],[1,"row","g-3","mb-4"],[1,"col-12"],[1,"text-uppercase","text-muted","small","fw-bold","mb-3","border-bottom","pb-2"],[1,"col-md-6"],[1,"form-label","fw-semibold","text-secondary","small"],[1,"input-group"],[1,"input-group-text","bg-white","border-end-0","text-muted"],[1,"bi","bi-building"],["name","codempr","required","",1,"form-select","border-start-0","ps-0",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"bi","bi-tags"],["name","tipoencf","required","",1,"form-select","border-start-0","ps-0",3,"ngModel","ngModelChange"],[1,"col-md-3"],["type","number","name","desdeencf","placeholder","1",1,"form-control",3,"ngModel","ngModelChange"],["type","number","name","hastaencf","placeholder","1000",1,"form-control",3,"ngModel","ngModelChange"],["type","number","name","cantencf","placeholder","Total",1,"form-control",3,"ngModel","ngModelChange"],["type","number","name","countencf","placeholder","0",1,"form-control",3,"ngModel","ngModelChange"],[1,"row","g-3"],[1,"col-md-4"],[1,"bi","bi-calendar"],["type","date","name","fechaencf","required","",1,"form-control","border-start-0","ps-0",3,"ngModel","ngModelChange"],["type","number","name","alertaencf","placeholder","20",1,"form-control","border-end-0",3,"ngModel","ngModelChange"],[1,"input-group-text","bg-white","border-start-0","text-muted"],[1,"form-text","small","mt-1"],[1,"d-flex","justify-content-end","gap-3","mt-5","pt-3","border-top"],["type","button",1,"btn","btn-light","px-4","border",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-2"],["type","submit",1,"btn","btn-primary","px-4","shadow-sm",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["class","bi bi-check-lg me-2",4,"ngIf"],[1,"card-header","bg-white","border-bottom","py-3","px-4","d-flex","justify-content-between","align-items-center"],[1,"bg-success","bg-opacity-10","p-2","rounded-circle","me-3","text-success"],[1,"bi","bi-list-check","fs-5"],[1,"card-body","p-0"],[1,"table-responsive",2,"max-height","500px","overflow-y","auto"],[1,"table","table-hover","align-middle","mb-0"],[1,"table-light","sticky-top"],[1,"text-secondary","small","text-uppercase"],[1,"py-3","ps-4"],[1,"py-3"],[1,"py-3","text-center"],[1,"py-3","text-center","pe-4"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","p-3","border-top","bg-light"],[1,"text-muted"],[1,"fw-bold","text-dark"],[1,"btn-group"],[1,"btn","btn-sm","btn-outline-secondary","bg-white",3,"disabled","click"],[1,"bi","bi-chevron-left","me-1"],[1,"bi","bi-chevron-right","ms-1"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-check-lg","me-2"],[1,"ps-4"],[1,"small","text-muted"],[1,"badge","bg-light","text-dark","border","fw-normal"],[1,"text-center","font-monospace","small","text-muted"],[1,"bi","bi-arrow-right","mx-1"],[1,"text-center","fw-bold"],[1,"text-center"],[1,"badge","bg-primary","bg-opacity-10","text-primary"],[1,"text-center","text-muted","small"],[1,"bi","bi-calendar-event","me-1"],["class","badge bg-warning bg-opacity-10 text-warning border border-warning",4,"ngIf"],["class","text-muted small",4,"ngIf"],[1,"text-center","pe-4"],["role","group",1,"btn-group","shadow-sm"],["title","Editar",1,"btn","btn-sm","btn-outline-secondary","bg-white",3,"click"],[1,"bi","bi-pencil"],["title","Eliminar",1,"btn","btn-sm","btn-outline-danger","bg-white",3,"click"],[1,"bi","bi-trash"],[1,"badge","bg-warning","bg-opacity-10","text-warning","border","border-warning"],[1,"text-muted","small"],["colspan","8",1,"text-center","py-5","text-muted"],[1,"d-flex","flex-column","align-items-center"],[1,"bg-light","rounded-circle","p-4","mb-3"],[1,"bi","bi-inbox","fs-1","text-secondary","opacity-50"],[1,"fw-semibold"]],template:function(r,n){if(1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e.nrm(7,"i",7),e.k0s(),e.j41(8,"h5",8),e.EFF(9,"Registro de ENCF"),e.k0s()()(),e.j41(10,"div",9)(11,"form",10,11),e.bIt("ngSubmit",function(){return n.guardarEncf()}),e.j41(13,"div",12)(14,"div",13)(15,"h6",14),e.EFF(16,"Informaci\xf3n General"),e.k0s()(),e.j41(17,"div",15)(18,"label",16),e.EFF(19,"Empresa *"),e.k0s(),e.j41(20,"div",17)(21,"span",18),e.nrm(22,"i",19),e.k0s(),e.j41(23,"select",20),e.bIt("ngModelChange",function(s){return n.encf.codempr=s}),e.j41(24,"option",21),e.EFF(25,"Seleccione una empresa"),e.k0s(),e.DNE(26,M,2,3,"option",22),e.k0s()()(),e.j41(27,"div",15)(28,"label",16),e.EFF(29,"Tipo de Comprobante *"),e.k0s(),e.j41(30,"div",17)(31,"span",18),e.nrm(32,"i",23),e.k0s(),e.j41(33,"select",24),e.bIt("ngModelChange",function(s){return n.encf.tipoencf=s}),e.j41(34,"option",21),e.EFF(35,"Seleccione un tipo"),e.k0s(),e.DNE(36,_,2,3,"option",22),e.k0s()()()(),e.j41(37,"div",12)(38,"div",13)(39,"h6",14),e.EFF(40,"Secuencia y Control"),e.k0s()(),e.j41(41,"div",25)(42,"label",16),e.EFF(43,"Desde"),e.k0s(),e.j41(44,"input",26),e.bIt("ngModelChange",function(s){return n.encf.desdeencf=s}),e.k0s()(),e.j41(45,"div",25)(46,"label",16),e.EFF(47,"Hasta"),e.k0s(),e.j41(48,"input",27),e.bIt("ngModelChange",function(s){return n.encf.hastaencf=s}),e.k0s()(),e.j41(49,"div",25)(50,"label",16),e.EFF(51,"Cantidad Total"),e.k0s(),e.j41(52,"input",28),e.bIt("ngModelChange",function(s){return n.encf.cantencf=s}),e.k0s()(),e.j41(53,"div",25)(54,"label",16),e.EFF(55,"Contador Actual"),e.k0s(),e.j41(56,"input",29),e.bIt("ngModelChange",function(s){return n.encf.countencf=s}),e.k0s()()(),e.j41(57,"div",30)(58,"div",13)(59,"h6",14),e.EFF(60,"Vigencia y Alertas"),e.k0s()(),e.j41(61,"div",31)(62,"label",16),e.EFF(63,"Fecha de Vencimiento *"),e.k0s(),e.j41(64,"div",17)(65,"span",18),e.nrm(66,"i",32),e.k0s(),e.j41(67,"input",33),e.bIt("ngModelChange",function(s){return n.encf.fechaencf=s}),e.k0s()()(),e.j41(68,"div",31)(69,"label",16),e.EFF(70,"Alerta de Consumo (%)"),e.k0s(),e.j41(71,"div",17)(72,"input",34),e.bIt("ngModelChange",function(s){return n.encf.alertaencf=s}),e.k0s(),e.j41(73,"span",35),e.EFF(74,"%"),e.k0s()(),e.j41(75,"div",36),e.EFF(76,"Notificar al llegar a este porcentaje disponible."),e.k0s()()(),e.j41(77,"div",37)(78,"button",38),e.bIt("click",function(){return n.limpiarFormulario()}),e.nrm(79,"i",39),e.EFF(80," Limpiar "),e.k0s(),e.j41(81,"button",40),e.DNE(82,x,1,0,"span",41),e.DNE(83,R,1,0,"i",42),e.EFF(84),e.k0s()()()()()(),e.j41(85,"div",2)(86,"div",3)(87,"div",43)(88,"div",5)(89,"div",44),e.nrm(90,"i",45),e.k0s(),e.j41(91,"h5",8),e.EFF(92,"Comprobantes Registrados"),e.k0s()()(),e.j41(93,"div",46)(94,"div",47)(95,"table",48)(96,"thead",49)(97,"tr",50)(98,"th",51),e.EFF(99,"Empresa"),e.k0s(),e.j41(100,"th",52),e.EFF(101,"Tipo"),e.k0s(),e.j41(102,"th",53),e.EFF(103,"Rango"),e.k0s(),e.j41(104,"th",53),e.EFF(105,"Cantidad"),e.k0s(),e.j41(106,"th",53),e.EFF(107,"Contador"),e.k0s(),e.j41(108,"th",53),e.EFF(109,"Vigencia"),e.k0s(),e.j41(110,"th",53),e.EFF(111,"Alerta"),e.k0s(),e.j41(112,"th",54),e.EFF(113,"Acciones"),e.k0s()()(),e.j41(114,"tbody"),e.DNE(115,$,33,17,"tr",55),e.DNE(116,w,9,0,"tr",56),e.k0s()()(),e.j41(117,"div",57)(118,"small",58),e.EFF(119," Mostrando p\xe1gina "),e.j41(120,"span",59),e.EFF(121),e.k0s(),e.EFF(122),e.k0s(),e.j41(123,"div",60)(124,"button",61),e.bIt("click",function(){return n.cambiarPagina(n.page-1)}),e.nrm(125,"i",62),e.EFF(126," Anterior "),e.k0s(),e.j41(127,"button",61),e.bIt("click",function(){return n.cambiarPagina(n.page+1)}),e.EFF(128," Siguiente "),e.nrm(129,"i",63),e.k0s()()()()()()()()),2&r){const o=e.sdS(12);e.R7$(23),e.Y8G("ngModel",n.encf.codempr),e.R7$(3),e.Y8G("ngForOf",n.empresas),e.R7$(7),e.Y8G("ngModel",n.encf.tipoencf),e.R7$(3),e.Y8G("ngForOf",n.tiposNcf),e.R7$(8),e.Y8G("ngModel",n.encf.desdeencf),e.R7$(4),e.Y8G("ngModel",n.encf.hastaencf),e.R7$(4),e.Y8G("ngModel",n.encf.cantencf),e.R7$(4),e.Y8G("ngModel",n.encf.countencf),e.R7$(11),e.Y8G("ngModel",n.encf.fechaencf),e.R7$(5),e.Y8G("ngModel",n.encf.alertaencf),e.R7$(9),e.Y8G("disabled",!o.valid||n.guardando),e.R7$(1),e.Y8G("ngIf",n.guardando),e.R7$(1),e.Y8G("ngIf",!n.guardando),e.R7$(1),e.SpI(" ",n.editIndex>=0?"Guardar Cambios":"Registrar ENCF"," "),e.R7$(31),e.Y8G("ngForOf",n.listaEncf),e.R7$(1),e.Y8G("ngIf",0===n.listaEncf.length),e.R7$(5),e.JRh(n.paginacion.page),e.R7$(1),e.SpI(" de ",n.paginacion.totalPages," "),e.R7$(2),e.Y8G("disabled",1===n.page),e.R7$(3),e.Y8G("disabled",n.paginacion.page>=n.paginacion.totalPages)}},dependencies:[f.Sq,f.bT,l.qT,l.xH,l.y7,l.me,l.Q0,l.wz,l.BC,l.cb,l.YS,l.vS,l.cV,f.QX,f.vh],styles:[".rounded-top-4[_ngcontent-%COMP%]{border-top-left-radius:1rem;border-top-right-radius:1rem}.rounded-4[_ngcontent-%COMP%]{border-radius:1rem}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.form-text[_ngcontent-%COMP%]{font-size:.85rem;color:#6c757d}"]})}}return i})()}];let G=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[g.iI.forChild(N),g.iI]})}}return i})(),Y=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[f.MD,G,l.X1,l.YN]})}}return i})()}}]);