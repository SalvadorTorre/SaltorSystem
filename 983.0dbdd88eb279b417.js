"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[983],{4983:(yt,T,m)=>{m.r(T),m.d(T,{ModuloFacturacion:()=>Ct});var f=m(9417),I=m(177),O=m(8871),M=m(4412),x=m(152),C=m(3294),w=m(5558),k=m(8141),j=m(5964),y=m(9437),E=m(7673),R=m(6354),V=m(8032),b=m.n(V),G=m(5378),A=m(4941),B=m.n(A),t=m(8699),L=m(1757),z=m(3290),Y=m(9287),U=m(9743),X=m(6687),J=m(8747),W=m(333),K=m(1919),q=m(151);const Z=["inputCodmerc"],H=["descripcionInput"],Q=["Tabladetalle"],tt=["buscarcodmercInput"];function et(l,u){if(1&l&&(t.j41(0,"div",165)(1,"span",166),t.EFF(2,"No."),t.k0s(),t.j41(3,"span",167),t.EFF(4),t.k0s()()),2&l){const e=t.XpG();t.R7$(4),t.JRh(e.formularioFacturacion.controls.fa_codFact.value)}}function ot(l,u){if(1&l&&(t.j41(0,"div",165),t.nrm(1,"i",168),t.j41(2,"span",169),t.EFF(3),t.k0s()()),2&l){const e=t.XpG();t.R7$(3),t.JRh(e.formularioFacturacion.controls.fa_fecFact.value)}}function it(l,u){if(1&l&&(t.j41(0,"option",170),t.EFF(1),t.k0s()),2&l){const e=u.$implicit;t.Y8G("value",e.codigo),t.R7$(1),t.Lme(" ",e.tipo," - ",e.desNcf," ")}}function at(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",171),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosCliente(a))}),t.nrm(1,"i",172),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndex),t.R7$(3),t.JRh(e.cl_nomClie)}}function nt(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",171),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosSector(a))}),t.nrm(1,"i",173),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndexsector),t.R7$(3),t.JRh(e.se_desSect)}}function rt(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",174),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosFpago(a))}),t.EFF(1),t.k0s()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndexfpago),t.R7$(1),t.SpI(" ",e.fp_descfpago," ")}}function ct(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",174),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosEnvio(a))}),t.EFF(1),t.k0s()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndexEnvio),t.R7$(1),t.SpI(" ",e.descripcion," ")}}function st(l,u){if(1&l){const e=t.RV6();t.j41(0,"div",175)(1,"button",176),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.abrirModalDetalle())}),t.nrm(2,"i",177),t.EFF(3,"Ver/Editar Productos "),t.k0s()()}}function lt(l,u){1&l&&(t.qex(0),t.nrm(1,"i",178),t.EFF(2,"Guardar"),t.bVm())}function dt(l,u){1&l&&(t.qex(0),t.nrm(1,"span",179),t.EFF(2,"Guardando..."),t.bVm())}function ut(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",171),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosInventario(a))}),t.nrm(1,"i",180),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndexcodmerc),t.R7$(3),t.Lme("",e.in_codmerc||e.IN_CODMERC," - ",e.in_desmerc||e.IN_DESMERC,"")}}function mt(l,u){if(1&l){const e=t.RV6();t.j41(0,"a",171),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.cargarDatosInventario(a))}),t.nrm(1,"i",180),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("active",i===o.selectedIndexdescripcionmerc),t.R7$(3),t.Lme("",e.in_codmerc||e.IN_CODMERC," - ",e.in_desmerc||e.IN_DESMERC,"")}}function ft(l,u){if(1&l){const e=t.RV6();t.j41(0,"div",187)(1,"button",188),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,a=t.XpG();return t.Njj(a.editarItem(o))}),t.nrm(2,"i",189),t.k0s(),t.j41(3,"button",190),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,a=t.XpG();return t.Njj(a.borarItem(o))}),t.nrm(4,"i",191),t.k0s()()}}function ht(l,u){if(1&l){const e=t.RV6();t.j41(0,"tr",181),t.bIt("click",function(){const a=t.eBV(e).index,r=t.XpG();return t.Njj(r.selectRow(a))}),t.j41(1,"td",182),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td",183),t.EFF(6),t.k0s(),t.j41(7,"td",184),t.EFF(8),t.nI1(9,"currency"),t.k0s(),t.j41(10,"td",185),t.EFF(11),t.nI1(12,"currency"),t.k0s(),t.j41(13,"td",183),t.DNE(14,ft,5,0,"div",186),t.k0s()()}if(2&l){const e=u.$implicit,i=u.index,o=t.XpG();t.AVh("table-active",i===o.selectedRow),t.R7$(2),t.SpI(" ",null==e.producto?null:e.producto.in_codmerc," "),t.R7$(2),t.JRh(null==e.producto?null:e.producto.in_desmerc),t.R7$(2),t.JRh(e.cantidad),t.R7$(2),t.JRh(t.bMT(9,8,e.precio)),t.R7$(3),t.SpI(" ",t.bMT(12,10,e.total)," "),t.R7$(3),t.Y8G("ngIf",o.habilitarIcono)}}function pt(l,u){1&l&&(t.j41(0,"tr")(1,"td",192),t.nrm(2,"i",193),t.EFF(3," No hay productos agregados "),t.k0s()())}function gt(l,u){if(1&l){const e=t.RV6();t.j41(0,"tr",194)(1,"td",182),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td",183),t.EFF(6),t.k0s(),t.j41(7,"td",185),t.EFF(8),t.k0s(),t.j41(9,"td",183)(10,"button",195),t.bIt("click",function(){const a=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.consultarFacturacion(a))}),t.nrm(11,"i",178),t.EFF(12,"Seleccionar "),t.k0s()()()}if(2&l){const e=u.$implicit,i=t.XpG();t.R7$(2),t.JRh(e.fa_codFact),t.R7$(2),t.JRh(e.fa_nomClie),t.R7$(2),t.JRh(i.formatFecha(e.fa_fecFact)),t.R7$(2),t.JRh(e.fa_valFact)}}function bt(l,u){1&l&&(t.j41(0,"tr")(1,"td",196),t.nrm(2,"i",193),t.EFF(3," No se encontraron facturas "),t.k0s()())}const _t=function(l){return{"background-color":l}},Ft=function(l){return{color:l}},vt=[{path:"",component:(()=>{class l{constructor(e,i,o,a,r,n,s,c,p,h){this.fb=e,this.servicioFacturacion=i,this.servicioCliente=o,this.http=a,this.ServicioInventario=r,this.ServicioUsuario=n,this.ServicioRnc=s,this.ServicioSector=c,this.servicioFpago=p,this.servicioNcf=h,this.isDisabled=!0,this.totalItems=0,this.pageSize=5,this.currentPage=1,this.maxPagesToShow=5,this.txtdescripcion="",this.txtcodigo="",this.descripcion="",this.codigo="",this.fecha="",this.descripcionBuscar=new M.t(""),this.codigoBuscar=new M.t(""),this.fechaBuscar=new M.t(""),this.habilitarFormulario=!1,this.modoedicionFacturacion=!1,this.modoconsultaFacturacion=!1,this.facturacionList=[],this.detFacturaList=[],this.selectedFacturacion=null,this.items=[],this.ncflist=[],this.selectedItem=null,this.totalGral=0,this.totalItbis=0,this.totalcosto=0,this.costoGral=0,this.subTotal=0,this.subtotaltxt="",this.itbitxt="",this.totalgraltxt="",this.txtFactura="",this.txtFecha="",this.txtNombre="",this.descuentotxt="",this.tiponcf="Consumidor Final",this.codmerc="",this.tipomerc="",this.descripcionmerc="",this.cantidadmerc=0,this.preciomerc=0,this.precioform=new f.MJ,this.cantidadform=new f.MJ,this.isEditing=!1,this.itemToEdit=null,this.codnotfound=!1,this.desnotfound=!1,this.mensagePantalla=!1,this.codmerVacio=!1,this.desmerVacio=!1,this.isLoading=!1,this.habilitarCampos=!1,this.sucursales=[],this.sucursalSeleccionada=null,this.habilitarIcono=!0,this.rncValue="",this.cancelarBusquedaDescripcion=!1,this.cancelarBusquedaCodigo=!1,this.numfacturaSubject=new M.t(""),this.nomclienteSubject=new M.t(""),this.selectedRow=-1,this.buscarNombre=new f.MJ,this.resultadoNombre=[],this.resultadoSector=[],this.resultadoFpago=[],this.listaFpago=[],this.buscarSector=new f.MJ,this.buscarFpago=new f.MJ,this.buscarEnvio=new f.MJ,this.listaEnvio=[{codigo:"1",descripcion:"Env\xedo"},{codigo:"2",descripcion:"Retiro Cliente"}],this.resultadoEnvio=[],this.selectedIndexEnvio=0,this.selectedIndex=1,this.selectedIndexsector=1,this.buscarcodmerc=new f.MJ,this.buscardescripcionmerc=new f.MJ,this.nativeElement=new f.MJ,this.resultadoCodmerc=[],this.selectedIndexcodmerc=1,this.selectedIndexfpago=1,this.resultadodescripcionmerc=[],this.selectedIndexdescripcionmerc=1,this.form=this.fb.group({fa_codVend:["",f.k0.required]}),this.crearFormularioFacturacion(),this.nomclienteSubject.pipe((0,x.B)(500),(0,C.F)(),(0,w.n)(d=>(this.txtdescripcion=d,this.servicioFacturacion.buscarFacturacion(this.currentPage,this.facturacionList.length,this.codigo,this.txtdescripcion)))).subscribe(d=>{d&&Array.isArray(d.data)?(this.facturacionList=d.data,this.totalItems=d.pagination?.total||0,this.currentPage=d.pagination?.page||1):(console.warn("Respuesta de b\xfasqueda por cliente no es v\xe1lida:",d),this.facturacionList=[],this.totalItems=0)}),this.numfacturaSubject.pipe((0,x.B)(500),(0,C.F)(),(0,w.n)(d=>(this.txtFactura=d,this.servicioFacturacion.buscarFacturacion(this.currentPage,this.facturacionList.length,this.codigo,this.txtdescripcion,this.txtFactura)))).subscribe(d=>{d&&Array.isArray(d.data)?(this.facturacionList=d.data,this.totalItems=d.pagination?.total||0,this.currentPage=d.pagination?.page||1):(console.warn("Respuesta de b\xfasqueda por n\xfamero de factura no es v\xe1lida:",d),this.facturacionList=[],this.totalItems=0)})}seleccionarFacturacion(e){this.selectedFacturacion=e}ngOnInit(){this.buscarTodasFacturacion(),this.buscarcodmerc.valueChanges.pipe((0,k.M)(e=>{console.log("DEBUG: Input Code Change:",e),this.resultadoCodmerc=[]}),(0,x.B)(300),(0,C.F)(),(0,j.p)(e=>""!==(e||"").toString().trim()),(0,k.M)(e=>console.log("DEBUG: Searching Code:",e)),(0,w.n)(e=>this.http.GetRequest(`/productos-buscador/${encodeURIComponent(e)}`).pipe((0,y.W)(i=>(console.error("Error en b\xfasqueda de c\xf3digo:",i),(0,E.of)({data:[]}))))),(0,R.T)(e=>(e&&Array.isArray(e.data)&&(e.data=e.data.map(i=>{const o={};return Object.keys(i).forEach(a=>{o[a.toLowerCase()]=i[a]}),o})),e))).subscribe(e=>{if(console.log(e.data),!e)return this.resultadoCodmerc=[],void(this.codnotfound=!1);Array.isArray(e.data)&&e.data.length?(this.resultadoCodmerc=e.data.sort((i,o)=>(i.in_codmerc||"").localeCompare(o.in_codmerc||"",void 0,{numeric:!0,sensitivity:"base"})),this.selectedIndexcodmerc=0,this.codnotfound=!1):this.codnotfound=!0}),$("#input1").focus(),$("#input1").select(),this.obtenerNcf(),this.obtenerfpago(),this.buscarFpago.valueChanges.subscribe(e=>{if(e){const i=e.toLowerCase();this.resultadoFpago=this.listaFpago.filter(o=>o.fp_descfpago.toLowerCase().includes(i))}else this.resultadoFpago=this.listaFpago;this.selectedIndexfpago=0}),this.buscarEnvio.valueChanges.subscribe(e=>{if(e){const i=e.toLowerCase();this.resultadoEnvio=this.listaEnvio.filter(o=>o.descripcion.toLowerCase().includes(i))}else this.resultadoEnvio=this.listaEnvio;this.selectedIndexEnvio=0}),this.buscardescripcionmerc.valueChanges.pipe((0,k.M)(e=>{console.log("DEBUG: Input Desc Change:",e),this.resultadodescripcionmerc=[]}),(0,x.B)(300),(0,C.F)(),(0,j.p)(e=>""!==(e||"").toString().trim()),(0,k.M)(e=>console.log("DEBUG: Searching Desc:",e)),(0,w.n)(e=>this.http.GetRequest(`/productos-buscador-desc/${encodeURIComponent(e)}`).pipe((0,y.W)(i=>(console.error("Error en b\xfasqueda de descripci\xf3n:",i),(0,E.of)({data:[]}))))),(0,R.T)(e=>(e&&Array.isArray(e.data)&&(e.data=e.data.map(i=>{const o={};return Object.keys(i).forEach(a=>{o[a.toLowerCase()]=i[a]}),o})),e))).subscribe(e=>{console.log(e.data),e?Array.isArray(e.data)&&e.data.length?(this.resultadodescripcionmerc=e.data,this.desnotfound=!1):this.desnotfound=!0:(this.resultadodescripcionmerc=[],this.desnotfound=!1)}),this.formularioFacturacion.get("fa_nomClie")?.valueChanges.pipe((0,x.B)(500),(0,C.F)(),(0,k.M)(()=>{this.resultadoNombre=[]}),(0,j.p)(e=>""!==e),(0,w.n)(e=>this.http.GetRequest(`/cliente-nombre/${e}`).pipe((0,y.W)(i=>(console.error("Error en b\xfasqueda de cliente:",i),(0,E.of)({data:[]})))))).subscribe(e=>{console.log(e.data),e?Array.isArray(e.data)&&(this.resultadoNombre=e.data):this.resultadoNombre=[]}),this.buscarSector.valueChanges.pipe((0,x.B)(500),(0,C.F)(),(0,k.M)(()=>{this.resultadoSector=[]}),(0,j.p)(e=>""!==e),(0,w.n)(e=>this.http.GetRequest(`/sector-nombre/${e}`).pipe((0,y.W)(i=>(console.error("Error en b\xfasqueda de sector:",i),(0,E.of)({data:[]})))))).subscribe(e=>{console.log(e.data),e?Array.isArray(e.data)&&(this.resultadoSector=e.data):this.resultadoSector=[]}),this.actualizarTotales(),this.buscarcodmerc.valueChanges.subscribe(e=>this.codmerc=e||""),this.buscardescripcionmerc.valueChanges.subscribe(e=>this.descripcionmerc=e||""),this.cantidadform.valueChanges.subscribe(e=>this.cantidadmerc=Number(e)||0),this.precioform.valueChanges.subscribe(e=>this.preciomerc=Number(e)||0),this.buscarcodmerc.enable(),this.buscardescripcionmerc.enable(),this.manageFieldsState()}manageFieldsState(){const e=this.formularioFacturacion.get("fa_rncFact"),i=this.formularioFacturacion.get("fa_nomClie"),o=["fa_dirClie","fa_telClie","fa_sector","fa_correo","fa_contacto","fa_fpago","fa_envio","fa_codVend"],a=()=>{const r=e?.value,n=i?.value,s=null!=r&&""!==r.toString().trim(),c=null!=n&&""!==n.toString().trim(),p=s||c;o.forEach(h=>{const d=this.formularioFacturacion.get(h);d&&(p?d.disabled&&d.enable({emitEvent:!1}):d.enabled&&d.disable({emitEvent:!1}))})};e?.valueChanges.subscribe(()=>a()),i?.valueChanges.subscribe(()=>a()),a()}obtenerfpago(){this.servicioFpago.obtenerTodosFpago().subscribe(e=>{this.listaFpago=e.data;const i=this.formularioFacturacion.get("fa_codfpago")?.value;if(i){const o=this.listaFpago.find(a=>a.fp_codfpago===i);o&&this.buscarFpago.setValue(o.fp_descfpago,{emitEvent:!1})}})}obtenerNcf(){this.servicioNcf.buscarTodosNcf().subscribe(e=>{this.ncflist=e.data})}crearFormularioFacturacion(){const i=this.formatofecha(new Date);this.formularioFacturacion=this.fb.group({fa_codFact:[{value:"",disabled:!0}],fa_fecFact:[{value:i,disabled:!0}],fa_valFact:[""],fa_subFact:[""],fa_itbiFact:[""],fa_codClie:[""],fa_cosFact:[""],fa_nomClie:[""],fa_rncFact:[null],fa_telClie:[""],fa_dirClie:[""],fa_correo:[""],fa_codVend:["",f.k0.required],fa_nomVend:[""],fa_status:[""],fa_sector:[""],fa_codZona:[null],fa_desZona:[""],fa_fpago:[""],fa_codfpago:["1"],fa_envio:[""],fa_ncfFact:[{value:"",disabled:!0}],fa_tipoNcf:[{value:"32",disabled:!0}],fa_contacto:[""]})}limpia(){this.crearFormularioFacturacion(),this.txtdescripcion="",this.txtFactura="",this.txtFecha="",this.codmerc="",this.descripcionmerc="",this.preciomerc=0,this.cantidadmerc=0,this.buscarcodmerc.setValue("",{emitEvent:!1}),this.buscardescripcionmerc.setValue("",{emitEvent:!1}),this.precioform.setValue(0,{emitEvent:!1}),this.cantidadform.setValue(0,{emitEvent:!1}),this.isEditing=!1,this.items=[],this.totalGral=0,this.totalItbis=0,this.subTotal=0,this.totalcosto=0,this.costoGral=0,this.factxt=0,this.actualizarTotales(),$("#input1").focus(),$("#input1").select()}editardetFacturacion(e){this.facturacionid=e.df_codFact}editarFacturacion(e){this.facturacionid=e.fa_codFact,this.modoedicionFacturacion=!0,this.formularioFacturacion.patchValue(e),this.tituloModalFacturacion="Editando Facturacion",$("#modalfacturacion").modal("show"),this.habilitarFormulario=!0,document.querySelectorAll(".seccion-productos input").forEach(o=>{o.disabled=!0}),this.items=[],this.servicioFacturacion.buscarFacturaDetalle(e.fa_codFact).subscribe(o=>{let a=0,n=0;o.data.forEach(c=>{const h=c.df_canMerc,d=c.df_preMerc,_=h*d;this.items.push({producto:{in_codmerc:c.df_codMerc,in_desmerc:c.df_desMerc,in_grumerc:"",in_tipoproduct:"",in_canmerc:0,in_caninve:0,in_fecinve:null,in_eximini:0,in_cosmerc:0,in_premerc:0,in_precmin:0,in_ucosto:0,in_porgana:0,in_peso:0,in_longitud:0,in_unidad:0,in_medida:0,in_longitu:0,in_fecmodif:null,in_amacen:0,in_imagen:"",in_status:"",in_itbis:!1,in_minvent:0},cantidad:h,precio:d,total:_,fecfactActual:new Date,costo:this.costotxt}),a+=_,this.totalItbis+=.18*_}),n=a+this.totalItbis,this.subTotal=a,this.totalItbis=this.totalItbis,this.totalGral=n})}buscarTodasFactura(e){this.servicioFacturacion.buscarTodasFacturacion().subscribe(i=>{console.log("buscarTodasFactura response:",i),i&&Array.isArray(i.data)?this.facturacionList=i.data:(console.warn("response.data is not an array:",i?.data),this.facturacionList=[]),console.log(this.facturacionList.length)})}consultarFacturacion(e){this.modoconsultaFacturacion=!0,this.formularioFacturacion.reset(),this.crearFormularioFacturacion(),this.formularioFacturacion.patchValue(e);const i=this.formatFecha(e.fa_fecFact);this.formularioFacturacion.patchValue({fa_fecFact:i}),this.tituloModalFacturacion="Consulta Factura",this.habilitarFormulario=!0,this.formularioFacturacion.disable(),console.log("ff",e),this.habilitarIcono=!1,document.querySelectorAll(".seccion-productos input").forEach(a=>{a.disabled=!0}),this.items=[],this.servicioFacturacion.buscarFacturaDetalle(e.fa_codFact).subscribe(a=>{let r=0,s=0;console.log("faa",a.data),a.data.forEach(h=>{const _=h.df_canMerc,v=h.df_preMerc,F=_*v,P=h.df_cosMerc;this.items.push({producto:{in_codmerc:h.df_codMerc,in_desmerc:h.df_desMerc,in_grumerc:"",in_tipoproduct:"",in_canmerc:0,in_caninve:0,in_fecinve:null,in_eximini:0,in_cosmerc:0,in_premerc:0,in_precmin:0,in_tramo:h.in_tramo,in_ucosto:0,in_porgana:0,in_peso:0,in_longitud:0,in_unidad:0,in_medida:0,in_longitu:0,in_fecmodif:null,in_amacen:0,in_imagen:"",in_status:"",in_itbis:!1,in_minvent:0},cantidad:_,precio:v,total:F,costo:P,fecfactActual:new Date}),r+=P,this.totalItbis+=.18*F}),s=r+this.totalItbis,this.subTotal=r,this.totalItbis=this.totalItbis,this.totalGral=s,this.factxt=100*(e.fa_valFact-e.fa_cosFact)/e.fa_cosFact,this.actualizarTotales()})}eliminarFacturacion(e){b().fire({title:"\xbfEst\xe1 seguro de eliminar este Facturacion?",text:"\xa1No podr\xe1 revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!"}).then(i=>{i.isConfirmed&&this.servicioFacturacion.eliminarFacturacion(e).subscribe(o=>{b().fire({title:"Excelente!",text:"Empresa eliminado correctamente.",icon:"success",timer:2e3,showConfirmButton:!1}),this.buscarTodasFacturacion()})})}formatofecha(e){const i=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getDate().toString().padStart(2,"0")}/${o}/${i}`}formatFecha(e){if(!e)return"";try{if(e instanceof Date)return this.formatofecha(e);const i=String(e);if(/^\d{4}-\d{2}-\d{2}/.test(i)){const a=new Date(i);if(!isNaN(a.getTime()))return this.formatofecha(a)}if(/^\d{2}\/\d{2}\/\d{4}$/.test(i))return i;const o=new Date(i);if(!isNaN(o.getTime()))return this.formatofecha(o)}catch{}return String(e)}toPrismaDate(e){if(!e)return"";if(e instanceof Date)return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`;const i=String(e),o=i.match(/^([0-3]?\d)\/([0-1]?\d)\/(\d{4})$/);if(o){const r=o[1].padStart(2,"0"),n=o[2].padStart(2,"0");return`${o[3]}-${n}-${r}`}if(/^\d{4}-\d{2}-\d{2}$/.test(i))return i;const a=new Date(i);return isNaN(a.getTime())?i:`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`}crearformulariodetFactura(){this.formulariodetFactura=this.fb.group({df_codFact:[""],df_fecFact:[""],df_codMerc:[""],df_desMerc:[""],df_canMerc:[""],df_preMerc:[""],df_valMerc:[""],df_unidad:[""],df_cosMerc:[""],df_codClie:[""],df_status:[""],df_tipomerc:[""]})}buscarTodasFacturacion(){this.txtFactura="",this.txtdescripcion="",this.txtFecha="",this.servicioFacturacion.buscarTodasFacturacion().subscribe(e=>{console.log("buscarTodasFacturacion response:",e),e&&Array.isArray(e.data)?this.facturacionList=e.data:(console.warn("response.data is not an array:",e?.data),this.facturacionList=[]),console.log(this.facturacionList.length)},e=>{console.error("Error cargando facturas:",e),this.facturacionList=[]})}buscaNombre(e){this.nomclienteSubject.next(e.target.value.toUpperCase())}buscaFactura(e){this.numfacturaSubject.next(e.target.value.toUpperCase())}convertToUpperCase(e){const i=e.target,o=i.selectionStart,a=i.selectionEnd;i.value=i.value.toUpperCase(),null!==o&&null!==a&&i.setSelectionRange(o,a)}moveFocus(e,i){"Enter"===e.key&&i&&(e.preventDefault(),i.focus())}moveFocuscodmerc(e,i,o){e.preventDefault();const a=e.target.value.trim();if(""===a)return this.codmerVacio=!0,i?.focus(),void i?.select?.();const r=a.toLowerCase();if(this.selectedIndexcodmerc>=0&&this.selectedIndexcodmerc<=this.resultadoCodmerc.length-1){const c=this.resultadoCodmerc[this.selectedIndexcodmerc];if(c)return this.cargarDatosInventario(c),o?.focus(),o?.select?.(),void(this.codmerVacio=!1)}const s=this.resultadoCodmerc.filter(c=>String(c.in_codmerc).toLowerCase().startsWith(r));if(s.length>0)return this.cargarDatosInventario(s[0]),o?.focus(),o?.select?.(),void(this.codmerVacio=!1);this.http.GetRequest(`/productos-buscador/${a}`).pipe((0,y.W)(c=>(console.error("Error en b\xfasqueda manual de c\xf3digo:",c),(0,E.of)({data:[]}))),(0,R.T)(c=>(c&&Array.isArray(c.data)&&(c.data=c.data.map(p=>{const h={};return Object.keys(p).forEach(d=>{h[d.toLowerCase()]=p[d]}),h})),c))).subscribe(c=>{if(c&&Array.isArray(c.data)&&c.data.length){const p=c.data.sort((d,_)=>(d.in_codmerc||"").localeCompare(_.in_codmerc||"",void 0,{numeric:!0,sensitivity:"base"}));this.resultadoCodmerc=p,this.selectedIndexcodmerc=0;const h=p.filter(d=>String(d.in_codmerc).toLowerCase().startsWith(r));if(h.length>0)return this.cargarDatosInventario(h[0]),o?.focus(),o?.select?.(),void(this.codmerVacio=!1)}this.mensagePantalla=!0,b().fire({icon:"error",title:"A V I S O",text:"Producto no encontrado.",focusConfirm:!0,allowEnterKey:!0,showConfirmButton:!1,timer:1200}).then(()=>{this.mensagePantalla=!1,i?.focus(),i?.select?.()}),this.codmerc="",this.descripcionmerc="",this.codmerVacio=!1})}handleKeydownInventario(e){console.log("handle");const i=e.key,o=this.resultadoCodmerc.length-1;if(1===this.resultadoCodmerc.length&&(this.selectedIndexcodmerc=0,console.log("prueba")),"ArrowDown"===i)this.selectedIndexcodmerc=this.selectedIndexcodmerc<o?this.selectedIndexcodmerc+1:0,e.preventDefault();else if("ArrowUp"===i)this.selectedIndexcodmerc=this.selectedIndexcodmerc>0?this.selectedIndexcodmerc-1:o,e.preventDefault();else if("Enter"===i){if(this.selectedIndexcodmerc>=0&&this.selectedIndexcodmerc<=o){this.cargarDatosInventario(this.resultadoCodmerc[this.selectedIndexcodmerc]);const a=document.getElementById("input15");a?.focus(),a?.select?.()}e.preventDefault()}}cargarDatosInventario(e){console.log(e),this.resultadoCodmerc=[],this.resultadodescripcionmerc=[];const i=(r,n)=>r[n]||r[n.toUpperCase()]||r[n.toLowerCase()];this.codmerc=i(e,"in_codmerc"),this.preciomerc=i(e,"in_premerc"),this.tipomerc=i(e,"in_tipoproduct"),this.descripcionmerc=i(e,"in_desmerc"),this.buscarcodmerc.setValue(this.codmerc,{emitEvent:!1}),this.buscardescripcionmerc.setValue(this.descripcionmerc,{emitEvent:!1}),this.precioform.setValue(this.preciomerc,{emitEvent:!1}),this.cantidadform.setValue(0,{emitEvent:!1}),this.existenciatxt=i(e,"in_canmerc"),this.costotxt=i(e,"in_cosmerc"),this.medidatxt=i(e,"in_medida"),this.fecacttxt=i(e,"in_fecmodif");const o=Number(this.costotxt)||0;this.atxt=o+5*o/100,this.btxt=o+7*o/100,this.ctxt=o+10*o/100,this.dtxt=o+12*o/100,this.etxt=o+14*o/100,this.ftxt=o+16*o/100,this.gtxt=o+18*o/100,this.htxt=o+20*o/100,this.protxt=o>0?100*(this.preciomerc-o)/o:0,this.productoselect=e,this.cancelarBusquedaDescripcion=!0,this.cancelarBusquedaCodigo=!0,this.formularioFacturacion.patchValue({df_codMerc:this.codmerc,df_desMerc:this.descripcionmerc,df_tipomerc:this.tipomerc,df_canMerc:this.existenciatxt,df_preMerc:this.preciomerc,df_cosMerc:this.costotxt,df_unidad:i(e,"in_unidad")});const a=document.getElementById("input15");a?.focus(),a?.select?.()}abrirModalDetalle(){$("#modalDetalleFactura").modal("show")}buscarUsuario(e,i){e.preventDefault();const o=this.formularioFacturacion.get("fa_codVend")?.value;if(!o)return this.mensagePantalla=!0,void b().fire({icon:"error",title:"A V I S O",text:"Codigo de usuario invalido."}).then(()=>{this.mensagePantalla=!1});this.ServicioUsuario.buscarUsuarioPorClave(o).subscribe(a=>{if(!a.data.length)return this.mensagePantalla=!0,void b().fire({icon:"error",title:"A V I S O",text:"Codigo de usuario invalido."}).then(()=>{this.mensagePantalla=!1});this.formularioFacturacion.patchValue({fa_nomVend:a.data[0].idUsuario}),this.abrirModalDetalle()})}buscarRnc(e,i){e.preventDefault();const o=this.formularioFacturacion.get("fa_rncFact")?.value;return o&&""!==o.trim()?9!==o.length&&11!==o.length?(this.mostrarMensajeError("RNC inv\xe1lido."),void console.log(o.length)):void this.ServicioRnc.buscarRncPorrncId(o).subscribe(a=>{a?.data?(console.log(a.data),this.formularioFacturacion.patchValue({fa_nomClie:a.data.rason}),this.formularioFacturacion.patchValue({fa_tipoNcf:"31"}),this.formularioFacturacion.get("fa_tipoNcf")?.enable(),this.isDisabled=!1,$("#input3").focus(),$("#input3").select()):(this.mostrarMensajeError("RNC inv\xe1lido."),console.log("RNC no encontrado."),this.isDisabled=!0)}):(this.formularioFacturacion.patchValue({fa_tipoNcf:"32"}),this.formularioFacturacion.get("fa_tipoNcf")?.disable(),void i?.focus())}mostrarMensajeError(e){this.mensagePantalla=!0,b().fire({icon:"error",title:"A V I S O",text:e}).then(()=>{this.mensagePantalla=!1})}handleKeydown(e){const i=e.key,o=this.resultadoNombre.length-1;if(1===this.resultadoNombre.length&&(this.selectedIndex=0,console.log("prueba")),"ArrowDown"===i)this.selectedIndex<o?this.selectedIndex++:this.selectedIndex=0,e.preventDefault();else if("ArrowUp"===i)console.log("paso 677"),this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=o,e.preventDefault();else if("Enter"===i){this.selectedIndex>=0&&this.selectedIndex<=o&&this.cargarDatosCliente(this.resultadoNombre[this.selectedIndex]);const a=this.formularioFacturacion.get("fa_nomClie")?.value;a&&""!==a.trim()&&(this.isDisabled=!1),e.preventDefault()}}handleKeydownSector(e){const i=e.key,o=this.resultadoSector.length-1;1===this.resultadoSector.length&&(this.selectedIndexsector=0,console.log("prueba")),"ArrowDown"===i?(this.selectedIndexsector<o?this.selectedIndex++:this.selectedIndexsector=0,e.preventDefault()):"ArrowUp"===i?(console.log("paso 677"),this.selectedIndexsector>0?this.selectedIndex--:this.selectedIndexsector=o,e.preventDefault()):"Enter"===i&&(this.selectedIndexsector>=0&&this.selectedIndexsector<=o&&this.cargarDatosSector(this.resultadoSector[this.selectedIndexsector]),e.preventDefault())}handleKeydownFpago(e){const i=e.key,o=this.resultadoFpago.length-1;if(1===this.resultadoFpago.length&&(this.selectedIndexfpago=0),"ArrowDown"===i)this.selectedIndexfpago<o?this.selectedIndexfpago++:this.selectedIndexfpago=0,e.preventDefault();else if("ArrowUp"===i)this.selectedIndexfpago>0?this.selectedIndexfpago--:this.selectedIndexfpago=o,e.preventDefault();else if("Enter"===i){if(this.selectedIndexfpago>=0&&this.selectedIndexfpago<=o&&this.resultadoFpago.length>0)this.cargarDatosFpago(this.resultadoFpago[this.selectedIndexfpago]);else if(0===this.resultadoFpago.length&&this.formularioFacturacion.get("fa_codfpago")?.value){const a=document.getElementById("input11");a&&a.focus()}e.preventDefault()}}handleKeydownInventariosdesc(e){const i=e.key,o=this.resultadodescripcionmerc.length;if(1===this.resultadodescripcionmerc.length&&(this.selectedIndexdescripcionmerc=0,console.log("prueba")),"ArrowDown"===i)this.selectedIndexdescripcionmerc=this.selectedIndexdescripcionmerc<o?this.selectedIndexdescripcionmerc+1:0,e.preventDefault();else if("ArrowUp"===i)this.selectedIndexdescripcionmerc=this.selectedIndexdescripcionmerc>0?this.selectedIndexdescripcionmerc-1:o,e.preventDefault();else if("Enter"===i){if(this.selectedIndexdescripcionmerc>=0&&this.selectedIndexdescripcionmerc<=o){this.cargarDatosInventario(this.resultadodescripcionmerc[this.selectedIndexdescripcionmerc]);const a=document.getElementById("input15");a?.focus(),a?.select?.()}e.preventDefault()}}moveFocusdesc(e,i){if("Enter"===e.key||"Tab"===e.key){e.preventDefault();const o=e.target.value.trim();if(""===o)return this.desmerVacio=!0,this.mensagePantalla=!0,b().fire({icon:"error",title:"A V I S O",text:"Producto no encontrado.",focusConfirm:!0,allowEnterKey:!0,showConfirmButton:!1,timer:1200}).then(()=>{this.mensagePantalla=!1;const s=e.target;s?.focus(),s?.select?.()}),void(this.desnotfound=!0);const a=o.toLowerCase();if(this.selectedIndexdescripcionmerc>=0&&this.selectedIndexdescripcionmerc<=this.resultadodescripcionmerc.length-1){const s=this.resultadodescripcionmerc[this.selectedIndexdescripcionmerc];if(s)return this.cargarDatosInventario(s),i?.focus(),i?.select?.(),this.desnotfound=!1,void(this.desmerVacio=!1)}const n=this.resultadodescripcionmerc.filter(s=>String(s.in_desmerc).toLowerCase().startsWith(a));if(n.length>0)return this.cargarDatosInventario(n[0]),i?.focus(),i?.select?.(),this.desnotfound=!1,void(this.desmerVacio=!1);this.http.GetRequest(`/productos-buscador-desc/${encodeURIComponent(o)}`).pipe((0,y.W)(s=>(console.error("Error en b\xfasqueda manual de descripci\xf3n:",s),(0,E.of)({data:[]})))).subscribe(s=>{if(s&&Array.isArray(s.data)&&s.data.length){const p=s.data.map(d=>{const _={};return Object.keys(d).forEach(v=>{_[v.toLowerCase()]=d[v]}),_}).sort((d,_)=>d.in_desmerc.localeCompare(_.in_desmerc,void 0,{sensitivity:"base"}));this.resultadodescripcionmerc=p,this.selectedIndexdescripcionmerc=0;const h=p.filter(d=>String(d.in_desmerc).toLowerCase().startsWith(a));if(h.length>0)return this.cargarDatosInventario(h[0]),i?.focus(),i?.select?.(),this.desnotfound=!1,void(this.desmerVacio=!1)}this.mensagePantalla=!0,b().fire({icon:"error",title:"A V I S O",text:"Producto no encontrado.",focusConfirm:!0,allowEnterKey:!0,showConfirmButton:!1,timer:1200}).then(()=>{this.mensagePantalla=!1;const c=e.target;c?.focus(),c?.select?.()}),this.desnotfound=!0,this.desmerVacio=!1})}}moveFocusCantidad(e,i){if("Enter"===e.key||"Tab"===e.key){if(e.preventDefault(),!this.productoselect||this.cantidadmerc<=0)return this.mensagePantalla=!0,void b().fire({icon:"error",title:"A V I S O",text:"Por favor complete todos los campos requeridos antes de continuar."}).then(()=>{this.mensagePantalla=!1});i?.focus(),i?.select?.()}}moveFocusPrecio(e,i){const o=e.key;if("Enter"===o||"Tab"===o){if(e.preventDefault(),!this.productoselect||this.preciomerc<=0||this.preciomerc<=this.productoselect.in_cosmerc)return this.mensagePantalla=!0,void b().fire({icon:"error",title:"A V I S O",text:"Por favor complete todos los campos requeridos antes de agregar el \xedtem."}).then(()=>{this.mensagePantalla=!1});"Enter"===o&&this.agregaItem(e),i?.focus(),i?.select?.()}}moveFocusnomclie(e,i){e.preventDefault(),console.log(i),e.target instanceof HTMLInputElement&&(e.target.value?i.focus():(this.mensagePantalla=!0,b().fire({icon:"error",title:"A V I S O",text:"Por favor complete el campo Nombre del Cliente Para Poder continual."}).then(()=>{this.mensagePantalla=!1})))}cargarDatosCliente(e){this.resultadoNombre=[],""!==e.cl_nomClie&&(console.log(this.resultadoNombre),this.formularioFacturacion.patchValue({fa_codClie:e.cl_codClie,fa_nomClie:e.cl_nomClie,fa_rncFact:e.cl_rnc,fa_telClie:e.cl_telClie,fa_dirClie:e.cl_dirClie,fa_codZona:e.cl_codZona,fa_sector:e.cl_codSect},{emitEvent:!1}),e.cl_rnc&&""!==String(e.cl_rnc).trim()?(this.formularioFacturacion.patchValue({fa_tipoNcf:"31"}),this.formularioFacturacion.get("fa_tipoNcf")?.enable()):(this.formularioFacturacion.patchValue({fa_tipoNcf:"32"}),this.formularioFacturacion.get("fa_tipoNcf")?.disable()),console.log(e),console.log("Formulario actualizado:",this.formularioFacturacion.value))}cargarDatosSector(e){this.resultadoNombre=[],this.buscarSector.reset(),""!==e.se_desSect&&(console.log(this.resultadoSector),this.formularioFacturacion.patchValue({fa_codSect:e.se_codSect,fa_sector:e.se_desSect,fa_codZona:e.se_codZona}),console.log(e))}cargarDatosFpago(e){if(this.resultadoFpago=[],this.buscarFpago.setValue(e.fp_descfpago,{emitEvent:!1}),""!==e.fp_descfpago){this.formularioFacturacion.patchValue({fa_codfpago:e.fp_codfpago});const i=document.getElementById("input11");i&&i.focus()}}cargarDatosEnvio(e){this.resultadoEnvio=[],this.buscarEnvio.setValue(e.descripcion,{emitEvent:!1}),this.formularioFacturacion.patchValue({fa_envio:e.codigo});const i=document.getElementById("input12");i&&i.focus()}handleKeydownEnvio(e){const i=e.key,o=this.resultadoEnvio.length-1;if("ArrowDown"===i)this.selectedIndexEnvio<o?this.selectedIndexEnvio++:this.selectedIndexEnvio=0,e.preventDefault();else if("ArrowUp"===i)this.selectedIndexEnvio>0?this.selectedIndexEnvio--:this.selectedIndexEnvio=o,e.preventDefault();else if("Enter"===i){if(this.selectedIndexEnvio>=0&&this.selectedIndexEnvio<=o)this.cargarDatosEnvio(this.resultadoEnvio[this.selectedIndexEnvio]);else if(0===this.resultadoEnvio.length&&this.formularioFacturacion.get("fa_envio")?.value){const a=document.getElementById("input12");a&&a.focus()}e.preventDefault()}}moveFocusFpago(e,i){e.preventDefault(),i&&i.focus()}agregaItem(e){if(e.preventDefault(),!this.productoselect||this.cantidadmerc<=0||this.preciomerc<=0||this.preciomerc<=this.productoselect.in_cosmerc)return this.mensagePantalla=!0,void b().fire({icon:"error",title:"A V I S O",text:"Por favor complete todos los campos requeridos antes de agregar el \xedtem."}).then(()=>{this.mensagePantalla=!1});const i=new Date;if(this.isEditing)this.itemToEdit.producto=this.productoselect,this.itemToEdit.codmerc=this.codmerc,this.itemToEdit.descripcionmerc=this.descripcionmerc,this.itemToEdit.precio=this.preciomerc,this.itemToEdit.cantidad=this.cantidadmerc,this.itemToEdit.total=this.cantidadmerc*this.preciomerc,this.itemToEdit.totalcosto+=this.costotxt*this.cantidadmerc,this.itemToEdit.fecfactActual=i,this.actualizarTotales(),this.isEditing=!1,this.itemToEdit=null;else{const o=this.cantidadmerc*this.preciomerc;this.totalGral+=o;const a=.18*o;this.totalItbis+=a,this.subTotal+=o-a;const r=this.costotxt*this.cantidadmerc;this.totalcosto+=this.costotxt*this.cantidadmerc,this.factxt=100*(this.totalGral-this.totalcosto)/this.totalcosto,this.protxt=100*(this.preciomerc-this.costotxt)/this.costotxt,this.items.push({producto:this.productoselect,cantidad:this.cantidadmerc,precio:this.preciomerc,total:o,costo:r,fecfactActual:i}),this.actualizarTotales(),this.cancelarBusquedaDescripcion=!1,this.cancelarBusquedaCodigo=!1}this.limpiarCampos()}actualizarCalculo(){const e=Number(this.precioform.value)||0;this.protxt=100*(e-this.costotxt)/this.costotxt}limpiarCampos(){this.codmerc="",this.descripcionmerc="",this.preciomerc=0,this.cantidadmerc=0,this.buscarcodmerc.setValue("",{emitEvent:!1}),this.buscardescripcionmerc.setValue("",{emitEvent:!1}),this.precioform.setValue(0,{emitEvent:!1}),this.cantidadform.setValue(0,{emitEvent:!1}),this.isEditing=!1,this.existenciatxt=0,this.costotxt=0,this.medidatxt=0,this.tipomerc="",this.fecacttxt=" ",this.atxt=0,this.btxt=0,this.ctxt=0,this.dtxt=0,this.etxt=0,this.ftxt=0,this.gtxt=0,this.htxt=0,this.protxt=0}limpiarTabla(){this.items=[],this.totalGral=0,this.totalItbis=0,this.subTotal=0,this.actualizarTotales()}borarItem(e){const i=this.items.indexOf(e);if(i>-1){this.totalGral-=e.total;const o=.18*e.total;this.totalItbis-=o,this.subTotal-=e.total-o,this.items.splice(i,1)}}editarItem(e){this.index_item=this.items.indexOf(e),this.isEditing=!0,this.itemToEdit=e,this.productoselect=e.producto,this.codmerc=e.producto.in_codmerc,this.descripcionmerc=e.producto.in_desmerc,this.preciomerc=e.precio,this.cantidadmerc=e.cantidad,this.existenciatxt=e.producto.in_canmerc,this.costotxt=e.producto.in_cosmerc,this.buscarcodmerc.setValue(this.codmerc,{emitEvent:!1}),this.buscardescripcionmerc.setValue(this.descripcionmerc,{emitEvent:!1}),this.precioform.setValue(this.preciomerc,{emitEvent:!1}),this.cantidadform.setValue(this.cantidadmerc,{emitEvent:!1})}actualizarTotales(){this.totalGral=this.items.reduce((i,o)=>i+o.total,0),this.totalItbis=this.items.reduce((i,o)=>i+.18*o.total,0),this.subTotal=this.items.reduce((i,o)=>i+(o.total-.18*o.total),0),this.totalcosto=this.items.reduce((i,o)=>i+this.costotxt*o.cantidad,0);const e=i=>i.toLocaleString("es-DO",{style:"currency",currency:"DOP"});this.subtotaltxt=e(this.subTotal),this.itbitxt=e(this.totalItbis),this.totalgraltxt=e(this.totalGral)}guardarFacturacion(){this.formularioFacturacion.get("fa_valFact")?.patchValue(this.totalGral),this.formularioFacturacion.get("fa_itbiFact")?.patchValue(this.totalItbis),this.formularioFacturacion.get("fa_cosFact")?.patchValue(this.totalcosto),this.formularioFacturacion.get("fa_subFact")?.patchValue(this.subTotal),this.formularioFacturacion.get("fa_tipoNcf").enable(),this.formularioFacturacion.get("fa_codFact").enable(),this.formularioFacturacion.get("fa_fecFact").enable(),this.formularioFacturacion.get("fa_nomVend").enable(),this.formularioFacturacion.get("fa_ncfFact").enable();const i={...this.formularioFacturacion.getRawValue()};i.fa_codEmpr=localStorage.getItem("codigoempresa"),i.fa_codSucu=parseInt(localStorage.getItem("idSucursal")||"0"),i.fa_tipoNcf&&(i.fa_tipoNcf=parseInt(i.fa_tipoNcf.toString(),10)),i.fa_fecFact=this.toPrismaDate(i.fa_fecFact),i.fa_rncFact=i.fa_rncFact||"";const o={factura:i,detalle:this.items};console.log("Datos",o),this.formularioFacturacion.get("fa_codClie");const r=this.formularioFacturacion.get("fa_nomClie")?.value,n=this.formularioFacturacion.get("fa_rncFact")?.value,s=r&&""!==r.toString().trim(),c=n&&""!==n.toString().trim();if(!s&&!c)return this.isLoading=!1,void b().fire({icon:"error",title:"Error de validaci\xf3n",text:"Debe ingresar un Nombre de Cliente o un RNC antes de facturar."});this.formularioFacturacion.valid?(this.isLoading=!0,this.servicioFacturacion.guardarFacturacion(o).subscribe(p=>{this.isLoading=!1,b().fire({title:"Excelente!",text:"Facturacion creada correctamente.",icon:"success",timer:1e3,showConfirmButton:!1}),this.buscarTodasFacturacion(),this.formularioFacturacion.reset(),this.crearFormularioFacturacion(),this.formularioFacturacion.enable(),this.limpia()},p=>{this.isLoading=!1,console.error("Error al guardar facturaci\xf3n:",p),b().fire({icon:"error",title:"Error",text:"Hubo un error al guardar la factura."})})):alert("Esta Factura no fue Guardada")}navigateTable(e){const i=e.key;"ArrowDown"===i?this.selectedRow<this.items.length-1&&(this.selectedRow++,this.selectRow(this.selectedRow)):"ArrowUp"===i&&this.selectedRow>0&&(this.selectedRow--,this.selectRow(this.selectedRow))}selectRow(e){this.selectedRow=e,this.selectedItem=this.items[e],console.log(this.selectedItem),this.calcularPorcentaje()}calcularPorcentaje(){this.protxt=100*(this.selectedItem.total-this.selectedItem.costo)/this.selectedItem.costo}ngAfterViewInit(){this.Tabladetalle.nativeElement.focus()}formatNumber(e){let i=Number(e);return isNaN(i)?" ":i.toLocaleString("en-US",{minimumFractionDigits:2})}generatePDF(e){console.log(e),this.servicioFacturacion.buscarFacturaDetalle(e.fa_codFact).subscribe(i=>{let o=0,r=0;i.data.forEach(g=>{const N=g.dc_canmerc,D=g.dc_premerc,S=N*D;this.items.push({producto:{in_codmerc:g.dc_codmerc,in_desmerc:g.dc_descrip,in_grumerc:"",in_tipoproduct:"",in_canmerc:0,in_caninve:0,in_fecinve:null,in_eximini:0,in_cosmerc:0,in_premerc:0,in_precmin:0,in_tramo:g.in_tramo,in_ucosto:0,in_porgana:0,in_peso:0,in_longitud:0,in_unidad:0,in_medida:0,in_longitu:0,in_fecmodif:null,in_amacen:0,in_imagen:"",in_status:"",in_itbis:!1,in_minvent:0},cantidad:N,precio:D,total:S,fecfactActual:new Date,costo:0}),o+=S,this.totalItbis+=.18*S}),r=o+this.totalItbis,this.subTotal=o,this.totalItbis=this.totalItbis,this.totalGral=r;const s=g=>g.toLocaleString("es-DO",{style:"currency",currency:"DOP"}),c=new G.default,v=(c.internal.pageSize.getWidth()-20)/2;c.addImage("assets/logo2.png","PNG",v,10,20,20),c.setFontSize(16),c.text("CENTRAL HIERRO, SRL",105,40,{align:"center"}),c.setFontSize(10),c.text("#172 Esq. Albert Thomas",105,47,{align:"center"}),c.text("809-384-2000, 809-384-200",105,52,{align:"center"}),c.text("1-30-29922-6",105,57,{align:"center"}),c.setFontSize(14),c.text("FACTURA",105,70,{align:"center"}),c.setFontSize(10),c.text(`No. ${e.fa_codFact}`,14,80),c.text(`Fecha: ${e.fa_fecFact}`,14,85),c.text(`Vendedido por: ${e.fa_nomVend}`,14,90),c.setFontSize(12),c.text("CLIENTE",14,100),c.setFontSize(10),c.text(e.fa_nomClie,14,106),B()(c,{head:[["Codigo","Descripci\xf3n","Cantidad","Precio","Itbis","Total"]],body:i.data.map(g=>[g.df_codMerc,g.df_desMerc,parseInt(g.df_canMerc),s(parseFloat(g.df_preMerc)),s(g.df_preMerc*g.df_canMerc*18/100),s(g.df_preMerc*g.df_canMerc)]),startY:115});const F=c.lastAutoTable.finalY;c.setFontSize(12),c.text("Subtotal:",118,F+10),c.setFontSize(10),c.text(`${s(o)} `,160,F+10),c.setFontSize(12),c.text("ITBIS:",118,F+16),c.setFontSize(10),c.text(`${s(this.totalItbis)} `,160,F+16),c.setFontSize(12),c.text("TOTAL A PAGAR: ",118,F+22),c.setFontSize(14),c.text(`${s(r)} `,160,F+22),c.setFontSize(12),c.setFontSize(14),c.text("WWW.GRUPOHIERRO.COM",105,F+47,{align:"center"}),c.setFontSize(12),c.text("*** Gracias por Preferirnos ***",105,F+55,{align:"center"});const P=c.output("blob"),wt=URL.createObjectURL(P);window.open(wt,"_blank")})}static{this.\u0275fac=function(i){return new(i||l)(t.rXU(f.ok),t.rXU(L._),t.rXU(z.d),t.rXU(Y.a),t.rXU(U.M),t.rXU(X.f),t.rXU(J.E),t.rXU(W.V),t.rXU(K.U),t.rXU(q.Y))}}static{this.\u0275cmp=t.VBU({type:l,selectors:[["facturacion"]],viewQuery:function(i,o){if(1&i&&(t.GBs(Z,5),t.GBs(H,5),t.GBs(Q,5),t.GBs(tt,5)),2&i){let a;t.mGM(a=t.lsd())&&(o.inputCodmerc=a.first),t.mGM(a=t.lsd())&&(o.descripcionInput=a.first),t.mGM(a=t.lsd())&&(o.Tabladetalle=a.first),t.mGM(a=t.lsd())&&(o.buscarcodmercElement=a.first)}},decls:342,vars:66,consts:[[1,"container-fluid","p-4","full-height-container"],[1,"row","g-4","main-row"],[1,"col-lg-8"],[1,"card","shadow-sm","border-0","h-100"],[1,"card-header","text-white","d-flex","justify-content-between","align-items-center",2,"background","linear-gradient(90deg, #0d6efd, #20c997)","box-shadow","0 2px 8px rgba(13,110,253,.2)"],[1,"mb-0","fw-semibold"],[1,"bi","bi-receipt","me-2"],[1,"d-flex","align-items-center","gap-3","small"],["class","d-flex align-items-center",4,"ngIf"],[1,"card-body","bg-light"],[3,"formGroup","ngSubmit"],[1,"d-none"],["type","text","formControlName","fa_codFact"],["type","text","formControlName","fa_fecFact"],[1,"row","g-3","mb-3"],[1,"col-md-4"],[1,"form-label","small","text-muted","fw-semibold"],["type","text","id","input1","formControlName","fa_rncFact",1,"form-control",3,"keydown.enter","keydown.tab"],["input1",""],[1,"col-md-5"],["name","tipoNcf","formControlName","fa_tipoNcf",1,"form-select",3,"keydown.enter"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3"],["type","text","formControlName","fa_ncfFact","placeholder","NCF",1,"form-control"],[1,"mb-3"],[1,"position-relative"],["type","text","autocomplete","off","id","input2","formControlName","fa_nomClie",1,"form-control","text-uppercase",3,"keydown.enter","keydown"],["input2",""],[1,"dropdown-menu","shadow-sm","w-100",2,"margin-top","2px","z-index","2000","max-height","250px","overflow-y","auto","border-radius","12px","border","none"],["class","dropdown-item d-flex align-items-center py-2","style","cursor: pointer",3,"active","click",4,"ngFor","ngForOf"],["type","text","id","input3","formControlName","fa_dirClie",1,"form-control","text-uppercase",3,"keydown.enter"],["input3",""],[1,"col-md-6"],["type","text","id","input4","formControlName","fa_telClie","placeholder","Tel\xe9fono",1,"form-control",3,"keydown.enter"],["input4",""],["type","text","formControlName","fa_sector","placeholder","Sector",1,"form-control","text-uppercase",3,"formControl","keydown.enter","keydown"],["input6",""],[1,"dropdown-menu","shadow-sm","w-100",2,"margin-top","2px","z-index","2000","max-height","200px","overflow-y","auto","border-radius","12px","border","none"],[1,"col-md-7"],["type","email","formControlName","fa_correo",1,"form-control",3,"keydown.enter"],["input7",""],["type","text","formControlName","fa_contacto","placeholder","Contacto",1,"form-control","text-uppercase",3,"keydown.enter"],["input8",""],[1,"row","g-3","mb-2"],[1,"col-md-4","position-relative"],["type","text","id","input9","placeholder","Seleccionar Pago","autocomplete","off",1,"form-control",3,"formControl","keydown","focus"],["input9",""],[1,"dropdown-menu","show","w-100",2,"max-height","200px","overflow-y","auto","position","absolute","z-index","1000"],["class","dropdown-item","href","javascript:void(0)",3,"active","click",4,"ngFor","ngForOf"],["type","text","id","input11","placeholder","Seleccionar Entrega","autocomplete","off",1,"form-control",3,"formControl","keydown","focus"],["input11",""],[1,"col-md-2"],["type","password","formControlName","fa_codVend","id","input12","placeholder","Cod.",1,"form-control","text-uppercase",3,"keydown.enter"],["input12",""],["type","text","formControlName","fa_nomVend","readonly","",1,"form-control"],[1,"col-lg-4"],[1,"card","border-success","shadow-sm","mb-4",2,"border-radius","12px"],[1,"card-header","bg-success","text-white","py-2"],[1,"mb-0","fw-bold","small"],[1,"bi","bi-calculator","me-2"],[1,"card-body","bg-light","p-3","d-flex","flex-column","justify-content-center"],[1,"alert","alert-primary","d-flex","align-items-center","justify-content-between","p-2","mb-3","shadow-sm","border-0",2,"background-color","#e7f1ff","color","#0d6efd"],[1,"fw-bold","small"],[1,"bi","bi-box-seam","me-2"],[1,"badge","bg-primary","rounded-pill","fs-6"],[1,"row","mb-2","align-items-center"],[1,"col-4"],[1,"small","fw-semibold","text-muted"],[1,"col-8"],["type","text","readonly","",1,"form-control","form-control-sm","fw-bold","text-end","border-0","bg-transparent","p-0","w-100",3,"ngModel","ngModelChange"],["type","text","readonly","",1,"form-control","form-control-sm","fw-bold","text-end","text-danger","border-0","bg-transparent","p-0","w-100",3,"ngModel","ngModelChange"],[1,"row","mb-3","align-items-center","border-bottom","pb-2"],[1,"row","mb-3","align-items-center"],[1,"h6","fw-bold","text-dark","mb-0"],["type","text","readonly","",1,"form-control","fw-bold","text-end","text-success","border-0","bg-transparent","p-0","fs-4","w-100",3,"ngModel","ngModelChange"],[1,"alert","alert-white","border","d-flex","justify-content-between","align-items-center","p-2","mb-0","mt-2","shadow-sm"],[1,"small","fw-bold","text-muted"],[1,"badge","rounded-pill",3,"ngStyle"],["class","d-grid gap-2 mt-3",4,"ngIf"],[1,"card","shadow-sm","border-0"],[1,"card-body"],[1,"text-muted","small","fw-bold","text-uppercase","mb-3","border-bottom","pb-2"],[1,"d-grid","gap-2"],["data-bs-toggle","modal","data-bs-target","#modalBuscarFactura",1,"btn","btn-outline-primary","mb-2",3,"click"],[1,"bi","bi-search","me-2"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary","flex-fill",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-1"],[1,"btn","btn-success","flex-fill",3,"disabled","click"],[4,"ngIf"],["id","modalDetalleFactura","tabindex","-1","aria-labelledby","modalDetalleFacturaLabel","aria-hidden","true","data-bs-backdrop","static","data-bs-keyboard","false",1,"modal","fade"],[1,"modal-dialog","modal-xl","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content","border-0","shadow-lg"],[1,"modal-header","bg-primary","text-white",2,"background","linear-gradient(90deg, #20c997, #0d6efd)"],["id","modalDetalleFacturaLabel",1,"modal-title","fw-semibold"],[1,"bi","bi-cart-plus","me-2"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body","bg-light"],[1,"card","border-0","shadow-sm","mb-3","bg-white"],[1,"card-body","p-3"],[1,"card-title","text-primary","fw-bold","mb-3","small","text-uppercase"],[1,"bi","bi-plus-circle","me-2"],[1,"row","g-2","align-items-end"],["type","text","autocomplete","off","placeholder","C\xf3digo",1,"form-control","text-uppercase","fw-bold",3,"formControl","keydown","keydown.enter"],["codigoInput","","input13",""],[1,"dropdown-menu","shadow-sm",2,"margin-top","2px","z-index","2000","max-height","300px","overflow-y","auto","border-radius","12px","border","none","min-width","450px"],["type","text","autocomplete","off","placeholder","Descripci\xf3n del producto",1,"form-control","text-uppercase",3,"formControl","keydown"],["descripcionInput","","input14",""],["type","number","placeholder","0","id","input15","min","1",1,"form-control","fw-bold","text-center",3,"formControl","keydown"],["input15",""],["type","number","min","0","step","0.01",1,"form-control","fw-bold","text-end",3,"formControl","input","keydown.enter"],["input16",""],["type","button","title","Agregar producto a la lista",1,"btn","btn-success","w-100","fw-semibold",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"table-responsive","detalle-table-container","mb-3","shadow-sm","bg-white","rounded"],["tabindex","0",1,"table","table-hover","table-sm","align-middle","mb-0",3,"keydown"],["Tabledetalle",""],[1,"sticky-top",2,"background","linear-gradient(90deg, #0d6efd, #20c997)","color","#fff"],[2,"width","13%"],[2,"width","37%"],[1,"text-center",2,"width","10%"],[1,"text-end",2,"width","13%"],[1,"text-end",2,"width","15%"],[1,"text-center",2,"width","12%"],["class","border-bottom",3,"table-active","click",4,"ngFor","ngForOf"],[1,"card","border-0","shadow-sm","bg-light"],[1,"text-primary","fw-bold","mb-3","small","text-uppercase",2,"letter-spacing","0.5px"],[1,"bi","bi-info-circle","me-2"],[1,"row","g-3","mb-4"],[1,"col-6","col-sm-4","col-md-2"],[1,"form-label","small","text-muted","mb-1","fw-semibold"],[1,"input-group","input-group-sm","bg-white","rounded","border"],["type","text","readonly","",1,"form-control","fw-bold","text-end","border-0","bg-transparent",3,"value"],["type","text","readonly","",1,"form-control","form-control-sm","fw-bold","text-center","border-0","bg-transparent",3,"ngModel","ngModelChange"],[1,"col-6","col-sm-4","col-md-3"],[1,"input-group-text","border-0","bg-transparent","text-muted"],["type","text","readonly","",1,"form-control","fw-bold","text-end","border-0","bg-transparent",3,"value","ngStyle"],[1,"text-secondary","fw-bold","mb-3","small","text-uppercase","border-top","pt-3",2,"letter-spacing","0.5px"],[1,"bi","bi-graph-up-arrow","me-2"],[1,"d-flex","flex-wrap","gap-2","justify-content-between"],[1,"border","rounded","px-2","py-2","bg-white","text-center","flex-fill","shadow-sm",2,"min-width","85px"],[1,"small","text-muted","fw-bold","mb-1"],[1,"fw-bold","text-dark"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"bi","bi-box-arrow-right","me-1"],["id","modalBuscarFactura","tabindex","-1","aria-labelledby","modalBuscarFacturaLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content","shadow-lg","border-0"],[1,"modal-header","text-white",2,"background","linear-gradient(90deg, #0d6efd, #6610f2)"],["id","modalBuscarFacturaLabel",1,"modal-title","fw-semibold"],[1,"modal-body"],["type","text","placeholder","Buscar por n\xfamero...",1,"form-control",3,"ngModel","ngModelChange","input"],["type","text","placeholder","Buscar por cliente...",1,"form-control","text-uppercase",3,"ngModel","ngModelChange","input"],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[1,"table-responsive",2,"max-height","400px","overflow-y","auto"],[1,"table","table-hover","align-middle","mb-0"],[1,"table-dark","sticky-top"],[2,"width","15%"],[2,"width","40%"],[1,"text-center",2,"width","15%"],[1,"text-end",2,"width","20%"],["class","border-bottom",4,"ngFor","ngForOf"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-circle","me-1"],[1,"d-flex","align-items-center"],[1,"opacity-75","me-1"],[1,"fw-bold","bg-white","bg-opacity-25","px-2","py-1","rounded"],[1,"bi","bi-calendar-event","opacity-75","me-1"],[1,"fw-bold"],[3,"value"],[1,"dropdown-item","d-flex","align-items-center","py-2",2,"cursor","pointer",3,"click"],[1,"bi","bi-person-circle","me-2","text-primary"],[1,"bi","bi-geo-alt","me-2","text-success"],["href","javascript:void(0)",1,"dropdown-item",3,"click"],[1,"d-grid","gap-2","mt-3"],[1,"btn","btn-primary","shadow-sm","fw-bold",3,"click"],[1,"bi","bi-cart-check","me-2"],[1,"bi","bi-check-circle","me-1"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-box-seam","me-2","text-success"],[1,"border-bottom",3,"click"],[1,"fw-semibold","text-primary"],[1,"text-center"],[1,"text-end"],[1,"text-end","fw-semibold"],["class","d-flex flex-wrap justify-content-center gap-1",4,"ngIf"],[1,"d-flex","flex-wrap","justify-content-center","gap-1"],["type","button","title","Editar",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-pencil"],["type","button","title","Eliminar",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],["colspan","6",1,"text-center","text-muted","py-4"],[1,"bi","bi-inbox","fs-1","d-block","mb-2"],[1,"border-bottom"],["data-bs-dismiss","modal","title","Cargar factura",1,"btn","btn-outline-success","btn-sm",3,"click"],["colspan","5",1,"text-center","text-muted","py-4"]],template:function(i,o){if(1&i){const a=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),t.nrm(6,"i",6),t.EFF(7,"Datos de Factura "),t.k0s(),t.j41(8,"div",7),t.DNE(9,et,5,1,"div",8),t.DNE(10,ot,4,1,"div",8),t.k0s()(),t.j41(11,"div",9)(12,"form",10),t.bIt("ngSubmit",function(){return o.guardarFacturacion()}),t.j41(13,"div",11),t.nrm(14,"input",12)(15,"input",13),t.k0s(),t.j41(16,"div",14)(17,"div",15)(18,"label",16),t.EFF(19,"RNC"),t.k0s(),t.j41(20,"input",17,18),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(36);return t.Njj(o.buscarRnc(n,s))})("keydown.tab",function(n){t.eBV(a);const s=t.sdS(36);return t.Njj(o.buscarRnc(n,s))}),t.k0s()(),t.j41(22,"div",19)(23,"label",16),t.EFF(24,"Tipo NCF"),t.k0s(),t.j41(25,"select",20),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(43);return t.Njj(o.moveFocus(n,s))}),t.DNE(26,it,2,3,"option",21),t.k0s()(),t.j41(27,"div",22)(28,"label",16),t.EFF(29,"NCF"),t.k0s(),t.nrm(30,"input",23),t.k0s()(),t.j41(31,"div",24)(32,"label",16),t.EFF(33,"Cliente"),t.k0s(),t.j41(34,"div",25)(35,"input",26,27),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(43);return t.Njj(o.moveFocusnomclie(n,s))})("keydown",function(n){return o.handleKeydown(n)}),t.k0s(),t.j41(37,"div",28),t.DNE(38,at,4,3,"a",29),t.k0s()()(),t.j41(39,"div",24)(40,"label",16),t.EFF(41,"Direcci\xf3n"),t.k0s(),t.j41(42,"input",30,31),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(49);return t.Njj(o.moveFocus(n,s))}),t.k0s()(),t.j41(44,"div",14)(45,"div",32)(46,"label",16),t.EFF(47,"Tel\xe9fono"),t.k0s(),t.j41(48,"input",33,34),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(55);return t.Njj(o.moveFocus(n,s))}),t.k0s()(),t.j41(50,"div",32)(51,"label",16),t.EFF(52,"Sector"),t.k0s(),t.j41(53,"div",25)(54,"input",35,36),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(63);return t.Njj(o.moveFocus(n,s))})("keydown",function(n){return o.handleKeydownSector(n)}),t.k0s(),t.j41(56,"div",37),t.DNE(57,nt,4,3,"a",29),t.k0s()()()(),t.j41(58,"div",14)(59,"div",38)(60,"label",16),t.EFF(61,"Correo"),t.k0s(),t.j41(62,"input",39,40),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(68);return t.Njj(o.moveFocus(n,s))}),t.k0s()(),t.j41(64,"div",19)(65,"label",16),t.EFF(66,"Contacto"),t.k0s(),t.j41(67,"input",41,42),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(74);return t.Njj(o.moveFocus(n,s))}),t.k0s()()(),t.j41(69,"div",43)(70,"div",44)(71,"label",16),t.EFF(72,"Tipo Pago"),t.k0s(),t.j41(73,"input",45,46),t.bIt("keydown",function(n){return o.handleKeydownFpago(n)})("focus",function(){return o.resultadoFpago=o.listaFpago}),t.k0s(),t.j41(75,"div",47),t.DNE(76,rt,2,3,"a",48),t.k0s()(),t.j41(77,"div",44)(78,"label",16),t.EFF(79,"Entrega"),t.k0s(),t.j41(80,"input",49,50),t.bIt("keydown",function(n){return o.handleKeydownEnvio(n)})("focus",function(){return o.resultadoEnvio=o.listaEnvio}),t.k0s(),t.j41(82,"div",47),t.DNE(83,ct,2,3,"a",48),t.k0s()(),t.j41(84,"div",51)(85,"label",16),t.EFF(86,"Vend."),t.k0s(),t.j41(87,"input",52,53),t.bIt("keydown.enter",function(n){t.eBV(a);const s=t.sdS(172);return t.Njj(o.buscarUsuario(n,s))}),t.k0s()(),t.j41(89,"div",51)(90,"label",16),t.EFF(91,"\xa0"),t.k0s(),t.nrm(92,"input",54),t.k0s()()()()()(),t.j41(93,"div",55)(94,"div",56)(95,"div",57)(96,"h6",58),t.nrm(97,"i",59),t.EFF(98,"Totales y Resumen"),t.k0s()(),t.j41(99,"div",60)(100,"div",61)(101,"span",62),t.nrm(102,"i",63),t.EFF(103,"Art\xedculos en Lista"),t.k0s(),t.j41(104,"span",64),t.EFF(105),t.k0s()(),t.j41(106,"div",65)(107,"div",66)(108,"span",67),t.EFF(109,"Sub-Total"),t.k0s()(),t.j41(110,"div",68)(111,"input",69),t.bIt("ngModelChange",function(n){return o.subtotaltxt=n}),t.k0s()()(),t.j41(112,"div",65)(113,"div",66)(114,"span",67),t.EFF(115,"Descuento"),t.k0s()(),t.j41(116,"div",68)(117,"input",70),t.bIt("ngModelChange",function(n){return o.descuentotxt=n}),t.k0s()()(),t.j41(118,"div",71)(119,"div",66)(120,"span",67),t.EFF(121,"ITBIS"),t.k0s()(),t.j41(122,"div",68)(123,"input",69),t.bIt("ngModelChange",function(n){return o.itbitxt=n}),t.k0s()()(),t.j41(124,"div",72)(125,"div",66)(126,"span",73),t.EFF(127,"Total"),t.k0s()(),t.j41(128,"div",68)(129,"input",74),t.bIt("ngModelChange",function(n){return o.totalgraltxt=n}),t.k0s()()(),t.j41(130,"div",75)(131,"span",76),t.EFF(132,"Margen Global"),t.k0s(),t.j41(133,"span",77),t.EFF(134),t.k0s()(),t.DNE(135,st,4,0,"div",78),t.k0s()(),t.j41(136,"div",79)(137,"div",80)(138,"h6",81),t.EFF(139,"Acciones"),t.k0s(),t.j41(140,"div",82)(141,"button",83),t.bIt("click",function(){return o.buscarTodasFacturacion()}),t.nrm(142,"i",84),t.EFF(143,"Buscar Factura "),t.k0s(),t.j41(144,"div",85)(145,"button",86),t.bIt("click",function(){return o.limpia()}),t.nrm(146,"i",87),t.EFF(147,"Deshacer "),t.k0s(),t.j41(148,"button",88),t.bIt("click",function(){return o.guardarFacturacion()}),t.DNE(149,lt,3,0,"ng-container",89),t.DNE(150,dt,3,0,"ng-container",89),t.k0s()()()()()()()(),t.j41(151,"div",90)(152,"div",91)(153,"div",92)(154,"div",93)(155,"h5",94),t.nrm(156,"i",95),t.EFF(157,"Detalle de Productos "),t.k0s(),t.nrm(158,"button",96),t.k0s(),t.j41(159,"div",97)(160,"div",98)(161,"div",99)(162,"h6",100),t.nrm(163,"i",101),t.EFF(164,"Agregar Producto "),t.k0s(),t.j41(165,"div",102)(166,"div",51)(167,"label",16),t.EFF(168,"C\xf3digo"),t.k0s(),t.j41(169,"div",25)(170,"input",103,104),t.bIt("keydown",function(n){return o.handleKeydownInventario(n)})("keydown.enter",function(n){t.eBV(a);const s=t.sdS(181),c=t.sdS(188);return t.Njj(o.moveFocuscodmerc(n,s,c))}),t.k0s(),t.j41(173,"div",105),t.DNE(174,ut,4,4,"a",29),t.k0s()()(),t.j41(175,"div",15)(176,"label",16),t.EFF(177,"Descripci\xf3n"),t.k0s(),t.j41(178,"div",25)(179,"input",106,107),t.bIt("keydown",function(n){t.eBV(a);const s=t.sdS(188);return t.Njj(o.moveFocusdesc(n,s))})("keydown",function(n){return o.handleKeydownInventariosdesc(n)}),t.k0s(),t.j41(182,"div",105),t.DNE(183,mt,4,4,"a",29),t.k0s()()(),t.j41(184,"div",51)(185,"label",16),t.EFF(186,"Cantidad"),t.k0s(),t.j41(187,"input",108,109),t.bIt("keydown",function(n){t.eBV(a);const s=t.sdS(193);return t.Njj(o.moveFocusCantidad(n,s))}),t.k0s()(),t.j41(189,"div",51)(190,"label",16),t.EFF(191,"Precio"),t.k0s(),t.j41(192,"input",110,111),t.bIt("input",function(){return o.actualizarCalculo()})("keydown.enter",function(n){t.eBV(a);const s=t.sdS(172);return t.Njj(o.moveFocusPrecio(n,s))}),t.k0s()(),t.j41(194,"div",51)(195,"button",112),t.bIt("click",function(n){return o.agregaItem(n)}),t.nrm(196,"i",113),t.EFF(197,"Agregar "),t.k0s()()()()(),t.j41(198,"div",114)(199,"table",115,116),t.bIt("keydown",function(n){return o.navigateTable(n)}),t.j41(201,"thead",117)(202,"tr")(203,"th",118),t.EFF(204,"C\xf3digo"),t.k0s(),t.j41(205,"th",119),t.EFF(206,"Descripci\xf3n"),t.k0s(),t.j41(207,"th",120),t.EFF(208,"Cant."),t.k0s(),t.j41(209,"th",121),t.EFF(210,"Precio"),t.k0s(),t.j41(211,"th",122),t.EFF(212,"Total"),t.k0s(),t.j41(213,"th",123),t.EFF(214,"Acciones"),t.k0s()()(),t.j41(215,"tbody"),t.DNE(216,ht,15,12,"tr",124),t.DNE(217,pt,4,0,"tr",89),t.k0s()()(),t.j41(218,"div",125)(219,"div",99)(220,"h6",126),t.nrm(221,"i",127),t.EFF(222,"Informaci\xf3n del Producto "),t.k0s(),t.j41(223,"div",128)(224,"div",129)(225,"label",130),t.EFF(226,"Existencia"),t.k0s(),t.j41(227,"div",131),t.nrm(228,"input",132),t.k0s()(),t.j41(229,"div",129)(230,"label",130),t.EFF(231,"Medida"),t.k0s(),t.j41(232,"div",131)(233,"input",133),t.bIt("ngModelChange",function(n){return o.medidatxt=n}),t.k0s()()(),t.j41(234,"div",129)(235,"label",130),t.EFF(236,"Actualizado"),t.k0s(),t.j41(237,"div",131)(238,"input",133),t.bIt("ngModelChange",function(n){return o.fecacttxt=n}),t.k0s()()(),t.j41(239,"div",134)(240,"label",130),t.EFF(241,"Costo"),t.k0s(),t.j41(242,"div",131)(243,"span",135),t.EFF(244,"$"),t.k0s(),t.nrm(245,"input",132),t.k0s()(),t.j41(246,"div",134)(247,"label",130),t.EFF(248,"Margen Actual"),t.k0s(),t.j41(249,"div",131),t.nrm(250,"input",136),t.k0s()()(),t.j41(251,"h6",137),t.nrm(252,"i",138),t.EFF(253,"Precios Sugeridos "),t.k0s(),t.j41(254,"div",139)(255,"div",140)(256,"div",141),t.EFF(257,"5%"),t.k0s(),t.j41(258,"div",142),t.EFF(259),t.k0s()(),t.j41(260,"div",140)(261,"div",141),t.EFF(262,"7%"),t.k0s(),t.j41(263,"div",142),t.EFF(264),t.k0s()(),t.j41(265,"div",140)(266,"div",141),t.EFF(267,"10%"),t.k0s(),t.j41(268,"div",142),t.EFF(269),t.k0s()(),t.j41(270,"div",140)(271,"div",141),t.EFF(272,"12%"),t.k0s(),t.j41(273,"div",142),t.EFF(274),t.k0s()(),t.j41(275,"div",140)(276,"div",141),t.EFF(277,"14%"),t.k0s(),t.j41(278,"div",142),t.EFF(279),t.k0s()(),t.j41(280,"div",140)(281,"div",141),t.EFF(282,"16%"),t.k0s(),t.j41(283,"div",142),t.EFF(284),t.k0s()(),t.j41(285,"div",140)(286,"div",141),t.EFF(287,"18%"),t.k0s(),t.j41(288,"div",142),t.EFF(289),t.k0s()(),t.j41(290,"div",140)(291,"div",141),t.EFF(292,"20%"),t.k0s(),t.j41(293,"div",142),t.EFF(294),t.k0s()()()()()(),t.j41(295,"div",143)(296,"button",144),t.nrm(297,"i",145),t.EFF(298,"Salir "),t.k0s()()()()(),t.j41(299,"div",146)(300,"div",147)(301,"div",148)(302,"div",149)(303,"h5",150),t.nrm(304,"i",84),t.EFF(305,"Buscar Factura "),t.k0s(),t.nrm(306,"button",96),t.k0s(),t.j41(307,"div",151)(308,"div",14)(309,"div",15)(310,"label",16),t.EFF(311,"No. Factura"),t.k0s(),t.j41(312,"input",152),t.bIt("ngModelChange",function(n){return o.txtFactura=n})("input",function(n){return o.buscaFactura(n)}),t.k0s()(),t.j41(313,"div",19)(314,"label",16),t.EFF(315,"Nombre Cliente"),t.k0s(),t.j41(316,"input",153),t.bIt("ngModelChange",function(n){return o.txtdescripcion=n})("input",function(n){return o.buscaNombre(n)}),t.k0s()(),t.j41(317,"div",22)(318,"label",16),t.EFF(319,"Fecha"),t.k0s(),t.j41(320,"input",154),t.bIt("ngModelChange",function(n){return o.txtFecha=n}),t.k0s()()(),t.j41(321,"div",155)(322,"table",156)(323,"thead",157)(324,"tr")(325,"th",158),t.EFF(326,"N\xfamero"),t.k0s(),t.j41(327,"th",159),t.EFF(328,"Cliente"),t.k0s(),t.j41(329,"th",160),t.EFF(330,"Fecha"),t.k0s(),t.j41(331,"th",161),t.EFF(332,"Valor"),t.k0s(),t.j41(333,"th",120),t.EFF(334,"Acci\xf3n"),t.k0s()()(),t.j41(335,"tbody"),t.DNE(336,gt,13,4,"tr",162),t.DNE(337,bt,4,0,"tr",89),t.k0s()()()(),t.j41(338,"div",143)(339,"button",163),t.nrm(340,"i",164),t.EFF(341,"Cerrar "),t.k0s()()()()()}2&i&&(t.R7$(9),t.Y8G("ngIf",o.formularioFacturacion.controls.fa_codFact.value),t.R7$(1),t.Y8G("ngIf",o.formularioFacturacion.controls.fa_fecFact.value),t.R7$(2),t.Y8G("formGroup",o.formularioFacturacion),t.R7$(14),t.Y8G("ngForOf",o.ncflist),t.R7$(11),t.xc7("display",o.resultadoNombre.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadoNombre),t.R7$(16),t.Y8G("formControl",o.buscarSector),t.R7$(2),t.xc7("display",o.resultadoSector.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadoSector),t.R7$(5),t.BMQ("disabled",!!o.isDisabled||null),t.R7$(11),t.Y8G("formControl",o.buscarFpago),t.R7$(2),t.xc7("display",o.resultadoFpago.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadoFpago),t.R7$(4),t.Y8G("formControl",o.buscarEnvio),t.R7$(2),t.xc7("display",o.resultadoEnvio.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadoEnvio),t.R7$(22),t.JRh(o.items.length),t.R7$(6),t.Y8G("ngModel",o.subtotaltxt),t.R7$(6),t.Y8G("ngModel",o.descuentotxt),t.R7$(6),t.Y8G("ngModel",o.itbitxt),t.R7$(6),t.Y8G("ngModel",o.totalgraltxt),t.R7$(4),t.Y8G("ngStyle",t.eq3(62,_t,o.factxt<10?"#dc3545":"#198754")),t.R7$(1),t.SpI("",o.formatNumber(o.factxt),"%"),t.R7$(1),t.Y8G("ngIf",o.items.length>0),t.R7$(13),t.Y8G("disabled",o.isLoading),t.R7$(1),t.Y8G("ngIf",!o.isLoading),t.R7$(1),t.Y8G("ngIf",o.isLoading),t.R7$(20),t.Y8G("formControl",o.buscarcodmerc),t.R7$(3),t.xc7("display",o.resultadoCodmerc.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadoCodmerc),t.R7$(5),t.Y8G("formControl",o.buscardescripcionmerc),t.R7$(3),t.xc7("display",o.resultadodescripcionmerc.length>0?"block":"none"),t.R7$(1),t.Y8G("ngForOf",o.resultadodescripcionmerc),t.R7$(4),t.Y8G("formControl",o.cantidadform),t.R7$(5),t.Y8G("formControl",o.precioform),t.R7$(24),t.Y8G("ngForOf",o.items),t.R7$(1),t.Y8G("ngIf",0===o.items.length),t.R7$(11),t.Y8G("value",o.formatNumber(o.existenciatxt)),t.R7$(5),t.Y8G("ngModel",o.medidatxt),t.R7$(5),t.Y8G("ngModel",o.fecacttxt),t.R7$(7),t.Y8G("value",o.formatNumber(o.costotxt)),t.R7$(5),t.Y8G("value",o.formatNumber(o.protxt)+"%")("ngStyle",t.eq3(64,Ft,o.protxt<10?"#dc3545":"#198754")),t.R7$(9),t.JRh(o.formatNumber(o.atxt)),t.R7$(5),t.JRh(o.formatNumber(o.btxt)),t.R7$(5),t.JRh(o.formatNumber(o.ctxt)),t.R7$(5),t.JRh(o.formatNumber(o.dtxt)),t.R7$(5),t.JRh(o.formatNumber(o.etxt)),t.R7$(5),t.JRh(o.formatNumber(o.ftxt)),t.R7$(5),t.JRh(o.formatNumber(o.gtxt)),t.R7$(5),t.JRh(o.formatNumber(o.htxt)),t.R7$(18),t.Y8G("ngModel",o.txtFactura),t.R7$(4),t.Y8G("ngModel",o.txtdescripcion),t.R7$(4),t.Y8G("ngModel",o.txtFecha),t.R7$(16),t.Y8G("ngForOf",o.facturacionList),t.R7$(1),t.Y8G("ngIf",0===o.facturacionList.length))},dependencies:[I.Sq,I.bT,I.B3,f.qT,f.xH,f.y7,f.me,f.Q0,f.wz,f.BC,f.cb,f.VZ,f.l_,f.j4,f.JD,f.vS,I.oe],styles:["[_nghost-%COMP%]{display:block;height:calc(100vh - 65px);overflow:hidden}.full-height-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;padding-bottom:.5rem}.main-row[_ngcontent-%COMP%]{flex:1;overflow:hidden}.col-left[_ngcontent-%COMP%], .col-right[_ngcontent-%COMP%]{height:100%;overflow-y:auto}.card-header[_ngcontent-%COMP%]{padding:.5rem 1rem!important}.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:1rem}.container-fluid[_ngcontent-%COMP%]{background-color:#f8f9fa}.card[_ngcontent-%COMP%]{border-radius:8px;transition:all .3s ease}.card-header[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;padding:1rem}.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0}.card-body[_ngcontent-%COMP%]{padding:1rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;border:1px solid #dee2e6;transition:all .3s ease;font-size:.9rem}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd26;outline:none}.form-control[_ngcontent-%COMP%]:disabled, .form-control[readonly][_ngcontent-%COMP%]{background-color:#e9ecef;cursor:not-allowed}.form-label[_ngcontent-%COMP%]{margin-bottom:.375rem;font-weight:500;font-size:.875rem}.table-responsive[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 0 10px #0000000d}.table-responsive[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:#212529;color:#fff;font-weight:600;font-size:.85rem;text-transform:uppercase;letter-spacing:.5px;padding:.6rem;border:none}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.65rem;vertical-align:middle;font-size:.9rem;border:1px solid #dee2e6}.table.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table.table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.45rem .5rem;font-size:.85rem;line-height:1.2}.table.table-sm[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem;font-size:.8rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:1px solid #dee2e6}.table-active[_ngcontent-%COMP%]{background-color:#e7f3ff!important}.btn[_ngcontent-%COMP%]{border-radius:6px;font-weight:500;transition:background-color .2s ease}.btn-sm[_ngcontent-%COMP%]{min-width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center}.dropdown-menu[_ngcontent-%COMP%]{border-radius:8px;border:1px solid #dee2e6;box-shadow:0 4px 12px #00000026;padding:.5rem 0;display:none}.dropdown-item[_ngcontent-%COMP%]{padding:.5rem 1rem;transition:all .2s ease;font-size:.9rem}.dropdown-item[_ngcontent-%COMP%]:hover, .dropdown-item.active[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.dropdown-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}i[_ngcontent-%COMP%]{cursor:pointer}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.gap-1[_ngcontent-%COMP%]{gap:.25rem}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:10px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}@media (max-width: 991px){.card-body[_ngcontent-%COMP%]{padding:.75rem}.table.table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem .3rem;font-size:.82rem}.btn-sm[_ngcontent-%COMP%]{min-width:28px;height:28px;font-size:.75rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{font-size:.85rem}.form-label[_ngcontent-%COMP%]{font-size:.8rem}}@media (max-width: 768px){.table.table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.35rem .2rem;font-size:.78rem}.btn-sm[_ngcontent-%COMP%]{min-width:26px;height:26px}.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:.9rem}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width: 576px){.container-fluid[_ngcontent-%COMP%]{padding:.5rem}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.3rem .2rem;font-size:.75rem}.btn-sm[_ngcontent-%COMP%]{min-width:24px;height:24px;font-size:.7rem}.btn-sm[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}}.modal-content[_ngcontent-%COMP%]{border-radius:12px;border:none}.modal-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:1.25rem 1.5rem;border-bottom:1px solid rgba(255,255,255,.1)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.info-producto[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.8rem}.info-producto[_ngcontent-%COMP%]   .form-control.form-control-sm[_ngcontent-%COMP%]{font-size:.85rem;line-height:1.2;padding:.35rem .5rem}.info-producto[_ngcontent-%COMP%]   .fs-5[_ngcontent-%COMP%]{font-size:1rem!important}.dropdown-menu.show[_ngcontent-%COMP%]{display:block}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#212529}.detalle-table-container[_ngcontent-%COMP%]{height:300px;min-height:300px;overflow-y:auto;border-radius:12px;box-shadow:0 6px 16px #00000014}.detalle-table-container[_ngcontent-%COMP%]   .table.table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .detalle-table-container[_ngcontent-%COMP%]   .table.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2!important;line-height:12px!important}.detalle-table-container[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.45rem}"]})}}return l})()}];let xt=(()=>{class l{static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275mod=t.$C({type:l})}static{this.\u0275inj=t.G2t({imports:[O.iI.forChild(vt),O.iI]})}}return l})(),Ct=(()=>{class l{static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275mod=t.$C({type:l})}static{this.\u0275inj=t.G2t({imports:[I.MD,xt,f.X1,f.YN]})}}return l})()}}]);