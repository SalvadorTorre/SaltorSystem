"use strict";(self.webpackChunkSaltorSystem=self.webpackChunkSaltorSystem||[]).push([[929],{6929:(N,b,l)=>{l.r(b),l.d(b,{TipousuarioModulo:()=>C});var p=l(177),h=l(8871),d=l(9417),f=l(1626),T=l(8032),m=l.n(T),t=l(8699),F=l(3584),_=l(5961);function v(r,c){if(1&r){const i=t.RV6();t.j41(0,"tr",51),t.bIt("click",function(){const n=t.eBV(i).$implicit,a=t.XpG();return t.Njj(a.seleccionarTipo(n))}),t.j41(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td")(6,"button",52),t.bIt("click",function(e){const n=t.eBV(i),a=n.$implicit,s=n.index;return t.XpG().abrirModalEditarTipo(a,s),t.Njj(e.stopPropagation())}),t.nrm(7,"i",53),t.k0s(),t.j41(8,"button",54),t.bIt("click",function(e){const a=t.eBV(i).$implicit;return t.XpG().eliminarTipo(a),t.Njj(e.stopPropagation())}),t.nrm(9,"i",55),t.k0s()()()}if(2&r){const i=c.$implicit,o=t.XpG();t.AVh("table-active",(null==o.seleccionado?null:o.seleccionado.id)===i.id),t.R7$(2),t.JRh(i.id),t.R7$(2),t.JRh(i.descripcion)}}function j(r,c){1&r&&(t.j41(0,"div",56),t.EFF(1,"Seleccione un tipo de usuario para ver sus m\xf3dulos."),t.k0s())}function E(r,c){if(1&r&&(t.j41(0,"div",57)(1,"strong"),t.EFF(2,"Tipo seleccionado:"),t.k0s(),t.EFF(3),t.k0s()),2&r){const i=t.XpG();t.R7$(3),t.Lme(" ",i.seleccionado.descripcion," (ID ",i.seleccionado.id,")")}}function k(r,c){if(1&r){const i=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"button",59),t.bIt("click",function(){const e=t.eBV(i),n=e.$implicit,a=e.index,s=t.XpG(2);return t.Njj(s.abrirModalEditarDet(n,a))}),t.nrm(9,"i",53),t.k0s(),t.j41(10,"button",60),t.bIt("click",function(){const n=t.eBV(i).$implicit,a=t.XpG(2);return t.Njj(a.eliminarDet(n))}),t.nrm(11,"i",55),t.k0s()()()}if(2&r){const i=c.$implicit,o=t.XpG(2);t.R7$(2),t.JRh(o.descModulo(i.idmodulo)),t.R7$(2),t.JRh(i.acceso),t.R7$(2),t.JRh(i.lectura)}}function M(r,c){if(1&r&&(t.j41(0,"div",15)(1,"table",16)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"M\xf3dulo"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Acceso"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Lectura"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Acciones"),t.k0s()()(),t.j41(12,"tbody"),t.DNE(13,k,12,3,"tr",58),t.k0s()()()),2&r){const i=t.XpG();t.R7$(13),t.Y8G("ngForOf",i.detalles)}}function x(r,c){if(1&r&&(t.j41(0,"option",44),t.EFF(1),t.k0s()),2&r){const i=c.$implicit;t.Y8G("ngValue",i.idmodulo),t.R7$(1),t.JRh(i.descmodulo)}}const D=[{path:"",component:(()=>{class r{constructor(i,o){this.tipoSrv=i,this.moduloSrv=o,this.tipos=[],this.detalles=[],this.modulos=[],this.filtroTipo="",this.seleccionado=null,this.actualTipo={descripcion:""},this.editTipoIndex=-1,this.actualDet={idmodulo:void 0,acceso:"N",lectura:"N"},this.editDetIndex=-1,this.Toast=m().mixin({toast:!0,position:"bottom-start",showConfirmButton:!1,timer:5e3,timerProgressBar:!1})}ngOnInit(){this.cargarTipos(),this.cargarModulos()}unwrapList(i){return i?Array.isArray(i)?i:Array.isArray(i?.data)?i.data:Array.isArray(i?.items)?i.items:Array.isArray(i?.data?.items)?i.data.items:[]:[]}cargarTipos(){this.tipoSrv.obtenerTodosTipousuario().subscribe({next:i=>{this.tipos=this.unwrapList(i)},error:()=>{this.tipos=[]}})}cargarModulos(){this.moduloSrv.obtenerTodosModulo().subscribe({next:i=>{this.modulos=this.unwrapList(i)},error:()=>{this.modulos=[]}})}cargarDetalles(){this.seleccionado?.id?this.tipoSrv.buscarTipousuario(Number(this.seleccionado.id)).subscribe({next:i=>{const o=Array.isArray(i?.data)?i.data[0]:i?.data||i;this.seleccionado=o||this.seleccionado,this.detalles=this.seleccionado?.dtipousuarios||[]},error:()=>{this.detalles=[]}}):this.detalles=[]}refrescarSeleccionado(){this.seleccionado?.id&&this.cargarDetalles()}get tiposFiltrados(){const i=this.filtroTipo.trim().toLowerCase();return i?this.tipos.filter(o=>String(o?.id||"").includes(i)||String(o?.descripcion||"").toLowerCase().includes(i)):this.tipos}seleccionarTipo(i){this.seleccionado=i,this.cargarDetalles()}descModulo(i){return i&&this.modulos.find(e=>e?.idmodulo===i)?.descmodulo||"-"}abrirModalNuevoTipo(){this.editTipoIndex=-1,this.actualTipo={descripcion:""}}abrirModalEditarTipo(i,o){this.editTipoIndex=o,this.actualTipo={descripcion:i?.descripcion}}guardarTipo(i){if(!i.valid)return;const o={descripcion:this.actualTipo.descripcion};if(this.editTipoIndex<0){const e=String(o.descripcion||"").trim().toLowerCase();if(this.tipos.some(a=>String(a?.descripcion||"").trim().toLowerCase()===e))return void this.Toast.fire({title:"Tipo de usuario duplicado",icon:"warning"})}if(this.editTipoIndex>=0){const e=this.tipos[this.editTipoIndex];this.tipoSrv.editarTipousuario(e.id,o).subscribe({next:()=>{e.descripcion=o.descripcion,this.cargarTipos(),this.Toast.fire({title:"Tipo actualizado",icon:"success",timer:4e3,timerProgressBar:!0})},error:()=>{this.Toast.fire({title:"Error al actualizar tipo",icon:"error"})}})}else this.tipoSrv.guardarTipousuario(o).subscribe({next:()=>{this.cargarTipos(),this.Toast.fire({title:"Tipo creado",icon:"success",timer:4e3,timerProgressBar:!0})},error:e=>{this.Toast.fire(409===e?.status?{title:"Tipo ya existe",icon:"warning"}:{title:"Error al crear tipo",icon:"error"})}});this.editTipoIndex=-1,this.actualTipo={descripcion:""},i.resetForm({descripcion:""})}eliminarTipo(i){!i||!i.id||m().fire({title:"Eliminar tipo",text:`\xbfEliminar el tipo "${i.descripcion}" (ID ${i.id})?`,icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&this.tipoSrv.eliminarTipousuario(i.id).subscribe({next:()=>{this.seleccionado?.id===i.id&&(this.seleccionado=null,this.detalles=[]),this.cargarTipos(),this.Toast.fire({title:"Tipo eliminado",icon:"success",timer:4e3,timerProgressBar:!0})},error:()=>{this.Toast.fire({title:"Error al eliminar tipo",icon:"error"})}})})}abrirModalNuevoDet(){this.editDetIndex=-1,this.actualDet={idmodulo:void 0,acceso:"N",lectura:"N"}}abrirModalEditarDet(i,o){this.editDetIndex=o,this.actualDet={idmodulo:i?.idmodulo,acceso:i?.acceso||"N",lectura:i?.lectura||"N"}}guardarDet(i){if(!i.valid||!this.seleccionado?.id)return;const o=Number(this.seleccionado.id),e=Number(this.actualDet.idmodulo),n=(this.actualDet.acceso||"N").toUpperCase(),a=(this.actualDet.lectura||"N").toUpperCase();if(!e||isNaN(e)||!["S","N"].includes(n)||!["S","N"].includes(a))return;const s={idtipousuario:o,idmodulo:e,acceso:n,lectura:a};if(this.editDetIndex>=0){const u=this.detalles[this.editDetIndex];this.tipoSrv.editarDetalle(u.id,s).subscribe({next:()=>{u.idmodulo=e,u.acceso=n,u.lectura=a,this.refrescarSeleccionado(),this.Toast.fire({title:"Detalle actualizado",icon:"success",timer:4e3,timerProgressBar:!0})},error:()=>{this.Toast.fire({title:"Error al actualizar detalle",icon:"error"})}})}else{if(this.detalles.some(g=>Number(g?.idmodulo)===e))return void this.Toast.fire({title:"M\xf3dulo ya asignado a este tipo",icon:"warning"});this.tipoSrv.agregarDetalle(o,s).subscribe({next:()=>{this.refrescarSeleccionado(),this.Toast.fire({title:"M\xf3dulo agregado al tipo",icon:"success",timer:4e3,timerProgressBar:!0})},error:g=>{this.Toast.fire(409===g?.status?{title:"M\xf3dulo duplicado para este tipo",icon:"warning"}:{title:"Error al agregar m\xf3dulo",icon:"error"})}})}this.editDetIndex=-1,this.actualDet={idmodulo:void 0,acceso:"N",lectura:"N"},i.resetForm({idmodulo:void 0,acceso:"N",lectura:"N"})}eliminarDet(i){!i||!i.id||m().fire({title:"Eliminar m\xf3dulo del tipo",text:"\xbfDesea eliminar este m\xf3dulo del tipo de usuario?",icon:"question",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&this.tipoSrv.eliminarDetalle(i.id).subscribe({next:()=>{this.refrescarSeleccionado(),this.Toast.fire({title:"M\xf3dulo eliminado del tipo",icon:"success",timer:4e3,timerProgressBar:!0})},error:()=>{this.Toast.fire({title:"Error al eliminar m\xf3dulo",icon:"error"})}})})}static{this.\u0275fac=function(o){return new(o||r)(t.rXU(F.b),t.rXU(_.V))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-config-tipousuario"]],decls:101,vars:18,consts:[[1,"container-fluid"],[1,"row","g-3"],[1,"col-12","col-xl-5"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center"],[1,"bi","bi-people","me-2"],[1,"mb-0"],["data-bs-toggle","modal","data-bs-target","#tipoModal",1,"btn","btn-light","btn-sm",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"card-body"],[1,"input-group","mb-3"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Buscar tipo...",1,"form-control",3,"ngModel","ngModelChange"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[3,"table-active","click",4,"ngFor","ngForOf"],[1,"col-12","col-xl-7"],[1,"card-header","bg-secondary","text-white","d-flex","align-items-center","justify-content-between"],[1,"bi","bi-ui-checks-grid","me-2"],["data-bs-toggle","modal","data-bs-target","#detModal",1,"btn","btn-light","btn-sm",3,"disabled","click"],["class","text-muted",4,"ngIf"],["class","mb-2",4,"ngIf"],["class","table-responsive",4,"ngIf"],["id","tipoModal","tabindex","-1","aria-labelledby","tipoModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","tipoModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[3,"ngSubmit"],["tipoForm","ngForm"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],["name","descripcion","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-primary",3,"disabled"],["id","detModal","tabindex","-1","aria-labelledby","detModalLabel","aria-hidden","true",1,"modal","fade"],["id","detModalLabel",1,"modal-title"],["detForm","ngForm"],["name","idmodulo","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-6"],["name","acceso","required","",1,"form-select",3,"ngModel","ngModelChange"],["value","S"],["value","N"],["name","lectura","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"click"],["data-bs-toggle","modal","data-bs-target","#tipoModal","title","Editar tipo","aria-label","Editar tipo",1,"btn","btn-primary","btn-sm","me-2",3,"click"],[1,"bi","bi-pencil"],["title","Eliminar tipo","aria-label","Eliminar tipo",1,"btn","btn-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],[1,"text-muted"],[1,"mb-2"],[4,"ngFor","ngForOf"],["data-bs-toggle","modal","data-bs-target","#detModal","title","Editar m\xf3dulo del tipo","aria-label","Editar m\xf3dulo del tipo",1,"btn","btn-primary","btn-sm","me-2",3,"click"],["title","Eliminar m\xf3dulo del tipo","aria-label","Eliminar m\xf3dulo del tipo",1,"btn","btn-danger","btn-sm",3,"click"]],template:function(o,e){if(1&o){const n=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6),t.j41(7,"h5",7),t.EFF(8,"Tipos de Usuario"),t.k0s()(),t.j41(9,"button",8),t.bIt("click",function(){return e.abrirModalNuevoTipo()}),t.nrm(10,"i",9),t.EFF(11," Nuevo "),t.k0s()(),t.j41(12,"div",10)(13,"div",11)(14,"span",12),t.nrm(15,"i",13),t.k0s(),t.j41(16,"input",14),t.bIt("ngModelChange",function(s){return e.filtroTipo=s}),t.k0s()(),t.j41(17,"div",15)(18,"table",16)(19,"thead")(20,"tr")(21,"th"),t.EFF(22,"#"),t.k0s(),t.j41(23,"th"),t.EFF(24,"Descripci\xf3n"),t.k0s(),t.j41(25,"th"),t.EFF(26,"Acciones"),t.k0s()()(),t.j41(27,"tbody"),t.DNE(28,v,10,4,"tr",17),t.k0s()()()()()(),t.j41(29,"div",18)(30,"div",3)(31,"div",19)(32,"div",5),t.nrm(33,"i",20),t.j41(34,"h5",7),t.EFF(35,"M\xf3dulos del Tipo"),t.k0s()(),t.j41(36,"button",21),t.bIt("click",function(){return e.abrirModalNuevoDet()}),t.nrm(37,"i",9),t.EFF(38," Agregar m\xf3dulo "),t.k0s()(),t.j41(39,"div",10),t.DNE(40,j,2,0,"div",22),t.DNE(41,E,4,2,"div",23),t.DNE(42,M,14,1,"div",24),t.k0s()()()(),t.j41(43,"div",25)(44,"div",26)(45,"div",27)(46,"div",28)(47,"h5",29),t.EFF(48),t.k0s(),t.nrm(49,"button",30),t.k0s(),t.j41(50,"form",31,32),t.bIt("ngSubmit",function(){t.eBV(n);const s=t.sdS(51);return t.Njj(e.guardarTipo(s))}),t.j41(52,"div",33)(53,"div",34)(54,"label",35),t.EFF(55,"Descripci\xf3n"),t.k0s(),t.j41(56,"input",36),t.bIt("ngModelChange",function(s){return e.actualTipo.descripcion=s}),t.k0s()()(),t.j41(57,"div",37)(58,"button",38),t.EFF(59,"Cancelar"),t.k0s(),t.j41(60,"button",39),t.EFF(61),t.k0s()()()()()(),t.j41(62,"div",40)(63,"div",26)(64,"div",27)(65,"div",28)(66,"h5",41),t.EFF(67),t.k0s(),t.nrm(68,"button",30),t.k0s(),t.j41(69,"form",31,42),t.bIt("ngSubmit",function(){t.eBV(n);const s=t.sdS(70);return t.Njj(e.guardarDet(s))}),t.j41(71,"div",33)(72,"div",34)(73,"label",35),t.EFF(74,"M\xf3dulo"),t.k0s(),t.j41(75,"select",43),t.bIt("ngModelChange",function(s){return e.actualDet.idmodulo=s}),t.j41(76,"option",44),t.EFF(77,"Seleccione un m\xf3dulo"),t.k0s(),t.DNE(78,x,2,2,"option",45),t.k0s()(),t.j41(79,"div",1)(80,"div",46)(81,"label",35),t.EFF(82,"Acceso"),t.k0s(),t.j41(83,"select",47),t.bIt("ngModelChange",function(s){return e.actualDet.acceso=s}),t.j41(84,"option",48),t.EFF(85,"S\xed"),t.k0s(),t.j41(86,"option",49),t.EFF(87,"No"),t.k0s()()(),t.j41(88,"div",46)(89,"label",35),t.EFF(90,"Lectura"),t.k0s(),t.j41(91,"select",50),t.bIt("ngModelChange",function(s){return e.actualDet.lectura=s}),t.j41(92,"option",48),t.EFF(93,"S\xed"),t.k0s(),t.j41(94,"option",49),t.EFF(95,"No"),t.k0s()()()()(),t.j41(96,"div",37)(97,"button",38),t.EFF(98,"Cancelar"),t.k0s(),t.j41(99,"button",39),t.EFF(100),t.k0s()()()()()()()}if(2&o){const n=t.sdS(51),a=t.sdS(70);t.R7$(16),t.Y8G("ngModel",e.filtroTipo),t.R7$(12),t.Y8G("ngForOf",e.tiposFiltrados),t.R7$(8),t.Y8G("disabled",!e.seleccionado),t.R7$(4),t.Y8G("ngIf",!e.seleccionado),t.R7$(1),t.Y8G("ngIf",e.seleccionado),t.R7$(1),t.Y8G("ngIf",e.seleccionado),t.R7$(6),t.JRh(e.editTipoIndex>=0?"Editar Tipo":"Nuevo Tipo"),t.R7$(8),t.Y8G("ngModel",e.actualTipo.descripcion),t.R7$(4),t.Y8G("disabled",!n.valid),t.R7$(1),t.JRh(e.editTipoIndex>=0?"Guardar cambios":"Agregar"),t.R7$(6),t.JRh(e.editDetIndex>=0?"Editar m\xf3dulo del tipo":"Agregar m\xf3dulo al tipo"),t.R7$(8),t.Y8G("ngModel",e.actualDet.idmodulo),t.R7$(1),t.Y8G("ngValue",void 0),t.R7$(2),t.Y8G("ngForOf",e.modulos),t.R7$(5),t.Y8G("ngModel",e.actualDet.acceso),t.R7$(8),t.Y8G("ngModel",e.actualDet.lectura),t.R7$(8),t.Y8G("disabled",!a.valid),t.R7$(1),t.JRh(e.editDetIndex>=0?"Guardar cambios":"Agregar")}},dependencies:[p.Sq,p.bT,d.qT,d.xH,d.y7,d.me,d.wz,d.BC,d.cb,d.YS,d.vS,d.cV],styles:[".table-active[_ngcontent-%COMP%]{cursor:pointer}.card-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border:none}.container-fluid[_ngcontent-%COMP%]{padding-bottom:1rem}"]})}}return r})()}];let C=(()=>{class r{static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275mod=t.$C({type:r})}static{this.\u0275inj=t.G2t({imports:[p.MD,d.YN,f.q1,h.iI.forChild(D)]})}}return r})()}}]);