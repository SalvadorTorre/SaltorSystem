<div class="card" style="height: 87vh">
  <div class="card-header">
    <h1>Empresas</h1>
  </div>
  <div class="card-body">
    <!-- buscador -->

    <div class="row">
      <div class="col-2">
        <label for="">Buscar Rnc Empresa</label>
        <input
          [(ngModel)]="txtcodigo"
          type="text"
          placeholder="Digite RNC"
          class="form-control"
          (input)="codigoEntra($event)"
        />
      </div>

      <div class="col-3">
        <label for="">Buscar Nombre</label>
        <input
          [(ngModel)]="txtdescripcion"
          type="text"
          placeholder="Digite Nombre..."
          class="form-control uppercase"
          (input)="descripcionEntra($event)"
        />
      </div>
      <div class="col-2">
        <button class="btn btn-danger mt-4" (click)="limpiaBusqueda()">
          <i class="bi bi-arrow-counterclockwise"></i>
        </button>
      </div>
      <div class="col-2">
        <button class="btn btn-primary mt-4" (click)="nuevaEmpresa()">
          Nueva Empresa
        </button>
      </div>
    </div>
    <!-- fin buscador -->
    <br />
    <!-- Grid -->
    <div class="table-responsive" style="max-height: 400px; overflow-y: auto">
      <table
        class="table table-bordered table-hover table-striped table-sm table-class"
      >
        <thead class="table-dark">
          <tr>
            <th style="width: 5%">Codigo</th>
            <th style="width: 8%">Rnc</th>
            <th style="width: 23%">Empresa</th>
            <th style="width: 15%">TeleFono</th>
            <th style="width: 35%">Direccion</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let empresa of empresaList">
            <td>{{empresa.cod_empre}}</td>
            <td>{{empresa.rnc_empre}}</td>
            <td>{{empresa.nom_empre}}</td>
            <td>{{empresa.tel_empre}}</td>
            <td>{{empresa.dir_empre}}</td>
            <td>

              <i
              (click)="editarEmpresa(empresa)"
              class="bi bi-pencil text-primary"
              style="padding: 10px"
             >
            </i>
            <i
            (click)="eliminarEmpresa(empresa.cod_empre)"
            class="bi bi-trash text-danger"
            style="padding: 10px"
           > 
            </i>
            <i
             (click)="consultarEmpresa(empresa)"
             class="bi bi-card-list text-success"
             style="padding: 10px"
           >
         </i>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(1)" aria-label="First">
            <span aria-hidden="true">««</span>
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a
            class="page-link"
            (click)="changePage(currentPage - 1)"
            aria-label="Previous"
          >
            <span aria-hidden="true">«</span>
          </a>
        </li>
        <li
          *ngFor="let page of pages"
          class="page-item"
          [class.active]="currentPage === page"
        >
          <a class="page-link" (click)="changePage(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a
            class="page-link"
            (click)="changePage(currentPage + 1)"
            aria-label="Next"
          >
            <span aria-hidden="true">»</span>
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a
            class="page-link"
            (click)="changePage(totalPages)"
            aria-label="Last"
          >
            <span aria-hidden="true">»»</span>
          </a>
        </li>
      </ul>
    </nav>
    <!-- Fin grid -->
  </div>
</div>

<!-- Formulario de cliente -->
<div
  class="modal fade"
  id="modalempresa"
  tabindex="-1"
  aria-labelledby="modalEmpresaLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-xl emp-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalEmpresaLabel">
          {{tituloModalEmpresa}}
        </h1>
        <button
          type="button"
          class="btn-close"
          (click)="cerrarModalEmpresa()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <!-- Columna: Datos de la Empresa -->
          <div class="col-lg-6">
            <form
              class="custom-form-background"
              [formGroup]="formularioEmpresa"
              (ngSubmit)="guardarEmpresa()"
            >
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Datos de la Empresa</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-2">
                      <label>Cod. Empresa</label>
                      <input
                        type="text"
                        class="uppercase-input"
                        (input)="convertToUpperCase($event)"
                        (keydown)="moveFocus($event, input2)"
                        #input1
                        class="form-control form-control-sm"
                        formControlName="cod_empre"
                      />
                    </div>
                    <div class="col-4">
                      <label>Rnc. Empresa</label>
                      <input
                        type="number"
                        class="uppercase-input"
                        (keydown)="moveFocus($event, input3)"
                        #input2
                        class="form-control form-control-sm"
                        formControlName="rnc_empre"
                      />
                    </div>
                    <div class="col-6">
                      <label>Nombre</label>
                      <input
                        type="text"
                        class="uppercase-input"
                        (input)="convertToUpperCase($event)"
                        (keydown)="moveFocus($event, input4)"
                        #input3
                        class="form-control form-control-sm"
                        formControlName="nom_empre"
                      />
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-4">
                      <h6>Telefono</h6>
                    </div>
                    <div class="col-4">
                      <h6>Direccion</h6>
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-4">
                      <input
                        type="text"
                        (keydown)="moveFocus($event, input5)"
                        #input4
                        class="form-control form-control-sm"
                        formControlName="tel_empre"
                      />
                    </div>
                    <div class="col-8">
                      <input
                        type="text"
                        class="uppercase-input"
                        (input)="convertToUpperCase($event)"
                        (keydown)="moveFocus($event, input6)"
                        #input5
                        class="form-control form-control-sm"
                        formControlName="dir_empre"
                      />
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-2">
                      <label for="">Iniciales</label>
                      <input
                        type="text"
                        class="uppercase-input"
                        (input)="convertToUpperCase($event)"
                        (keydown)="moveFocus($event, input7)"
                        #input6
                        class="form-control form-control-sm"
                        formControlName="letra_empre"
                      />
                    </div>

                    <div class="col-4">
                      <label for="">Control Orden Compra</label>
                      <input
                        type="number"
                        (keydown)="moveFocus($event, input7)"
                        #input7
                        class="form-control form-control-sm"
                        formControlName="orden_compra"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-4">
                <div class="col d-flex justify-content-end">
                  <button
                    type="submit"
                    *ngIf="!modoconsultaEmpresa"
                    class="btn btn-success"
                  >
                    {{modoedicionEmpresa ? "Guardar Cambio" : "Guardar"}}
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Columna: Sucursales -->
          <div class="col-lg-6">
            <div class="card" *ngIf="activaformularioSucursal">
              <div class="card-header">
                <h6 class="mb-0">Datos de Sucursal</h6>
              </div>
              <div class="card-body">
                <form
                  [formGroup]="formularioSucursal"
                  (ngSubmit)="guardarSucursal()"
                >
                  <div class="row">
                    <div class="col-10">
                      <div class="row">
                        <div class="col-8">
                          <label>Nombre Sucursal</label>
                          <input
                            type="text"
                            class="uppercase-input"
                            (input)="convertToUpperCase($event)"
                            (keydown)="moveFocus($event, input2)"
                            #input1
                            class="form-control form-control-sm"
                            formControlName="nom_sucursal"
                          />
                        </div>
                        <div class="col-4">
                          <label>Telefono</label>
                          <input
                            type="text"
                            (keydown)="moveFocus($event, input3)"
                            #input2
                            class="form-control form-control-sm"
                            formControlName="tel_sucursal"
                          />
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <label>Direccion</label>
                          <input
                            type="text"
                            class="uppercase-input"
                            (input)="convertToUpperCase($event)"
                            (keydown)="moveFocus($event, input3)"
                            #input3
                            class="form-control form-control-sm"
                            formControlName="dir_sucursal"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-2 mt-4">
                      <div class="row">
                        <div class="col">
                          <button type="submit" class="btn btn-success">
                            Guardar
                          </button>
                        </div>
                      </div>
                      &nbsp;&nbsp;
                      <div class="row">
                        <div class="col">
                          <button
                            type="button"
                            class="btn btn-danger"
                            (click)="cerrarModalEmpresa()"
                          >
                            Cancelar
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="row mt-3" *ngIf="activatablaSucursal">
              <!-- *ngIf="activatablaSucursal">-->
              <!--  && modoconsultaEmpresa && modoedicionEmpresa">-->
              <div
                class="table-responsive"
              style="max-height: 380px; overflow-y: auto"
              >
                <table
                  class="table table-bordered table-hover table-striped table-sm"
                >
                  <thead class="table-dark">
                    <tr>
                      <th style="width: 8%">Codigo</th>
                      <th style="width: 30%">Sucursal</th>
                      <th style="width: 30%">Telefono</th>
                      <th style="width: 30%">Dirección</th>
                      <th style="width: 10%">Año</th>
                      <th style="width: 10%">Secuencia</th>
                      <th style="width: 10%">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let sucursal of sucursalList">
                      <td class="text-center">{{sucursal.cod_sucursal}}</td>
                      <td class="text">{{sucursal.nom_sucursal}}</td>
                      <td class="text">{{sucursal.tel_sucursal}}</td>
                      <td class="text">{{sucursal.dir_sucursal}}</td>
                      <td class="text-center">{{ contfacturaPorSucursal[sucursal.cod_sucursal]?.ano ?? '-' }}</td>
                      <td class="text-end">{{ contfacturaPorSucursal[sucursal.cod_sucursal]?.contador ?? '-' }}</td>
                      <td>
                        <button
                          class="btn btn-link"
                          (click)="abrirContFacturaModal(sucursal)"
                          title="Editar control de factura"
                        >
                          <i class="bi bi-pencil-square text-primary"></i>
                        </button>
                        <button
                          class="btn btn-link"
                          (click)="eliminarSucursal(sucursal.cod_sucursal)"
                        >
                          <i class="bi bi-trash text-danger"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Control de Factura por Sucursal -->
<div class="modal fade" id="contFacModalEmpresa" tabindex="-1" aria-labelledby="contFacModalEmpresaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="contFacModalEmpresaLabel">{{contfacturaEditId ? 'Editar Control de Factura' : 'Nuevo Control de Factura'}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #contEmpresaForm="ngForm" (ngSubmit)="guardarContFacturaEmpresa(contEmpresaForm)">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Sucursal</label>
            <input class="form-control" type="text" [value]="contSucursalNombre" readonly />
          </div>
          <div class="mb-3">
            <label class="form-label">Año</label>
            <input class="form-control" type="number" name="ano" [(ngModel)]="contfacturaActual.ano" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Contador</label>
            <input class="form-control" type="number" name="contador" [(ngModel)]="contfacturaActual.contador" required />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="!contEmpresaForm.valid" data-bs-dismiss="modal">{{contfacturaEditId ? 'Guardar cambios' : 'Agregar'}}</button>
        </div>
      </form>
    </div>
  </div>
</div>
