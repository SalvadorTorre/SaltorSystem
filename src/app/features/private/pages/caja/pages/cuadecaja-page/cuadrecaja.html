<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">Cierre de Caja</h2>
    </div>
  </div>

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-end">
        <div class="col-md-4">
          <label for="fecha" class="form-label">Fecha del Cierre</label>
          <input type="date" id="fecha" class="form-control" [(ngModel)]="fechaCuadre">
        </div>
        <div class="col-md-4">
          <label for="inicio" class="form-label">Desde Factura (Última Cuadrada)</label>
          <input type="text" id="inicio" class="form-control" [(ngModel)]="facturaInicio" placeholder="Ej: 000001">
        </div>
        <div class="col-md-4">
          <button class="btn btn-primary w-100" (click)="buscarFacturas()" [disabled]="cargando">
            <i class="fas fa-search"></i> Buscar Movimientos
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Resumen -->
  <div class="row mb-4" *ngIf="facturas.length > 0">
    <div class="col-md-3">
      <div class="card text-white bg-success mb-3">
        <div class="card-header">Efectivo</div>
        <div class="card-body">
          <h3 class="card-title">{{ resumenPagos.efectivo | currency:'DOP' }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-info mb-3">
        <div class="card-header">Tarjeta</div>
        <div class="card-body">
          <h3 class="card-title">{{ resumenPagos.tarjeta | currency:'DOP' }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-warning mb-3">
        <div class="card-header">Depósito/Transferencia</div>
        <div class="card-body">
          <h3 class="card-title">{{ resumenPagos.deposito | currency:'DOP' }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-dark mb-3">
        <div class="card-header">Total General</div>
        <div class="card-body">
          <h3 class="card-title">{{ resumenPagos.total | currency:'DOP' }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla Detalle -->
  <div class="card" *ngIf="facturas.length > 0">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Detalle de Facturas ({{ facturas.length }})</span>
      <button class="btn btn-danger" (click)="generarReporte()">
        <i class="fas fa-file-pdf"></i> Generar Cierre PDF
      </button>
    </div>
    <div class="card-body table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>No. Factura</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Forma Pago</th>
            <th class="text-end">Monto</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let f of facturas">
            <td>{{ f.fa_codFact }}</td>
            <td>{{ f.fa_fecFact | date:'dd/MM/yyyy' }}</td>
            <td>{{ f.fa_nomClie }}</td>
            <td>{{ f.fa_fpago || f.fa_codfpago }}</td>
            <td class="text-end">{{ f.fa_valFact | currency:'DOP' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="facturas.length === 0 && !cargando" class="alert alert-info mt-3">
    No se encontraron facturas para los criterios seleccionados.
  </div>
</div>
